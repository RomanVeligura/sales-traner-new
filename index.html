<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ —Ç–µ—Ö–Ω–∏–∫–∏ –ø—Ä–æ–¥–∞–∂ –∞–≤—Ç–æ —Å –ø—Ä–æ–±–µ–≥–æ–º</title>
    <meta name="description" content="–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –º–µ—Ç–æ–¥–∏—á–∫–∞ –∏ –ò–ò-—Ç—Ä–µ–Ω–∞–∂–µ—Ä –¥–ª—è —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–æ–≤ –ø–æ –ø—Ä–æ–¥–∞–∂–∞–º –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π —Å –ø—Ä–æ–±–µ–≥–æ–º.">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f4f7f9;
            color: #1a202c;
        }
        .nav-link {
            transition: all .2s ease-in-out;
            border-left: 3px solid transparent;
        }
        .nav-link.active {
            color: #2563eb;
            border-left-color: #2563eb;
            background-color: #eff6ff;
            transform: translateX(2px);
        }
        .nav-link:hover {
            color: #2563eb;
            background-color: #eff6ff;
        }
        .nav-submenu {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s ease-in-out;
        }
        .nav-toggle.open .nav-submenu {
            max-height: 500px;
        }
        .chevron-nav {
            transition: transform 0.3s ease;
        }
        .nav-toggle.open .chevron-nav {
            transform: rotate(90deg);
        }
        .nav-link-parent:hover {
            background-color: #eff6ff;
        }
        .card {
            transition: box-shadow .3s ease-in-out;
        }
        .card-header {
            cursor: pointer;
        }
        .card-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height .5s cubic-bezier(.4, 0, .2, 1);
        }
        .card.open .card-content {
            max-height: 2500px;
        }
        .chevron {
            transition: transform .3s ease-in-out;
        }
        .card.open .chevron {
            transform: rotate(180deg);
        }
        blockquote {
            border-left: 4px solid #dbeafe;
            padding-left: 1rem;
            margin: 1rem 0;
            font-style: italic;
            color: #4a5568;
        }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3b82f6;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .chat-bubble {
            max-width: 75%;
            padding: 10px 15px;
            border-radius: 20px;
        }
        .user-bubble {
            background-color: #3b82f6;
            color: #fff;
            align-self: flex-end;
        }
        .ai-bubble {
            background-color: #e5e7eb;
            color: #1f2937;
            align-self: flex-start;
        }
        #back-to-top {
            position: fixed;
            bottom: 1.5rem;
            right: 1.5rem;
            background-color: #2563eb;
            color: white;
            padding: 0.75rem;
            border-radius: 9999px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: opacity 0.3s, visibility 0.3s;
            opacity: 0;
            visibility: hidden;
            cursor: pointer;
            z-index: 1000;
        }
        #back-to-top.show {
            opacity: 1;
            visibility: visible;
        }
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
        }
        .modal-overlay.show {
            opacity: 1;
            visibility: visible;
        }
        .modal-content {
            background: white;
            padding: 2rem;
            border-radius: 0.5rem;
            max-width: 600px;
            width: 90%;
            transform: scale(0.95);
            transition: transform 0.3s;
        }
        .modal-overlay.show .modal-content {
            transform: scale(1);
        }
        .correct-answer { background-color: #dcfce7; }
        .incorrect-answer { background-color: #fee2e2; }
    </style>
</head>
<body class="antialiased">

    <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-10">
        <header class="text-center mb-12">
            <h1 class="text-4xl md:text-5xl font-bold text-gray-800 mb-2">–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ —Ç–µ—Ö–Ω–∏–∫–∏ –ø—Ä–æ–¥–∞–∂</h1>
            <p class="text-lg text-gray-600">–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –º–µ—Ç–æ–¥–∏—á–∫–∞ –¥–ª—è –¥–æ–≤–µ—Ä–µ–Ω–Ω–æ–≥–æ –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–∞</p>
        </header>

        <div class="flex flex-col lg:flex-row gap-10">
            <aside class="lg:w-1/4 lg:sticky top-10 self-start">
                <nav class="bg-white rounded-lg shadow-sm p-4">
                    <h3 class="font-bold text-lg mb-4 px-2">–†–∞–∑–¥–µ–ª—ã</h3>
                    <ul class="space-y-1" id="navigation">
                        <li class="nav-toggle">
                            <div class="nav-link-parent flex justify-between items-center cursor-pointer p-2 rounded-md">
                                <span class="font-bold text-gray-800">–≠—Ç–∞–ø—ã —Ä–∞–±–æ—Ç—ã —Å –∫–ª–∏–µ–Ω—Ç–æ–º</span>
                                <svg class="w-4 h-4 chevron-nav text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                            </div>
                            <ul class="nav-submenu ml-2 mt-1 space-y-1">
                                <li><a href="#stage1" class="nav-link block font-medium text-gray-600 p-2 rounded-md">1. –¶–∏—Ñ—Ä–æ–≤–æ–µ —Ä—É–∫–æ–ø–æ–∂–∞—Ç–∏–µ</a></li>
                                <li><a href="#stage2" class="nav-link block font-medium text-gray-600 p-2 rounded-md">2. –ü–µ—Ä–≤—ã–µ 5 –º–∏–Ω—É—Ç</a></li>
                                <li><a href="#stage3" class="nav-link block font-medium text-gray-600 p-2 rounded-md">3. –°–æ–≤–º–µ—Å—Ç–Ω–æ–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ</a></li>
                                <li><a href="#stage4" class="nav-link block font-medium text-gray-600 p-2 rounded-md">4. –î–æ–∫–∞–∑–∞—Ç–µ–ª—å–Ω–∞—è –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—è</a></li>
                                <li><a href="#stage5" class="nav-link block font-medium text-gray-600 p-2 rounded-md">5. –ü–µ—Ä–µ–≥–æ–≤–æ—Ä—ã –æ —Ü–µ–Ω–Ω–æ—Å—Ç–∏</a></li>
                                <li><a href="#stage6" class="nav-link block font-medium text-gray-600 p-2 rounded-md">6. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–æ–∑—Ä–∞–∂–µ–Ω–∏—è–º–∏</a></li>
                                <li><a href="#stage7" class="nav-link block font-medium text-gray-600 p-2 rounded-md">7. –ó–∞–∫—Ä—ã—Ç–∏–µ —Å–¥–µ–ª–∫–∏</a></li>
                            </ul>
                        </li>
                        <li><a href="#ai-trainer-section" class="nav-link block font-medium text-gray-600 p-2 rounded-md"><strong>ü§ñ –ò–ò-–¢—Ä–µ–Ω–∞–∂–µ—Ä</strong></a></li>
                        <li><a href="#analysis-section" class="nav-link block font-medium text-gray-600 p-2 rounded-md"><strong>üìä –ê–Ω–∞–ª–∏–∑ –¥–∏–∞–ª–æ–≥–∞</strong></a></li>
                        <li><a href="#library-section" class="nav-link block font-medium text-gray-600 p-2 rounded-md"><strong>üìö –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –≤–æ–∑—Ä–∞–∂–µ–Ω–∏–π</strong></a></li>
                        <li><a href="#objection-generator-section" class="nav-link block font-medium text-gray-600 p-2 rounded-md"><strong>‚ú® –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –≤–æ–∑—Ä–∞–∂–µ–Ω–∏–π</strong></a></li>
                        <li><a href="#knowledge-section" class="nav-link block font-medium text-gray-600 p-2 rounded-md"><strong>üß† –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π</strong></a></li>
                        <li><a href="#mistakes-section" class="nav-link block font-medium text-gray-600 p-2 rounded-md"><strong>üö´ –†–∞–∑–±–æ—Ä –æ—à–∏–±–æ–∫</strong></a></li>
                        <li><a href="#quiz-section" class="nav-link block font-medium text-gray-600 p-2 rounded-md"><strong>üìù –¢–µ—Å—Ç</strong></a></li>
                    </ul>
                </nav>
            </aside>

            <main class="lg:w-3/4">
                <section id="paradigm" class="bg-white p-8 rounded-lg shadow-md mb-10">
                    <h2 class="text-3xl font-bold text-gray-800 mb-4">–ù–æ–≤–∞—è –ø–∞—Ä–∞–¥–∏–≥–º–∞: –æ—Ç –ø—Ä–æ–¥–∞–≤—Ü–∞ –∫ –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç—É</h2>
                    <p class="text-gray-700 leading-relaxed">–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –∫–ª–∏–µ–Ω—Ç –ø—Ä–æ–≤–µ–ª –¥–µ—Å—è—Ç–∫–∏ —á–∞—Å–æ–≤ –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ, –∏–∑—É—á–∏–ª –æ–±–∑–æ—Ä—ã –∏ –∑–Ω–∞–µ—Ç –æ —Ç–∏–ø–∏—á–Ω—ã—Ö "–±–æ–ª—è—á–∫–∞—Ö" –º–æ–¥–µ–ª–∏ –Ω–µ —Ö—É–∂–µ –≤–∞—Å. –û–Ω –ø—Ä–∏—Ö–æ–¥–∏—Ç –Ω–µ –∑–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π, –∞ –∑–∞ <strong>–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º —Å–≤–æ–µ–≥–æ –≤—ã–±–æ—Ä–∞ –∏ –ø–æ–∏—Å–∫–æ–º –¥–æ–≤–µ—Ä–∏—è</strong>. –í–∞—à–∞ –∑–∞–¥–∞—á–∞ ‚Äî –Ω–µ "–ø—Ä–æ–¥–∞—Ç—å" –µ–º—É –∞–≤—Ç–æ–º–æ–±–∏–ª—å, –∞ –ø–æ–º–æ—á—å <strong>—É–≤–µ—Ä–µ–Ω–Ω–æ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ –µ–≥–æ –∫—É–ø–∏—Ç—å</strong>.</p>
                </section>
                
                <div class="space-y-8" id="stages-container">
                </div>
                
                <section id="ai-trainer-section" class="scroll-mt-10 pt-10">
                    <div class="mb-8">
                        <h3 class="text-3xl font-bold text-gray-800 mb-2">ü§ñ –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Ç—Ä–µ–Ω–∞–∂–µ—Ä</h3>
                        <p class="text-gray-600 leading-relaxed">–û—Ç—Ç–æ—á–∏—Ç–µ —Å–≤–æ–∏ –Ω–∞–≤—ã–∫–∏ –≤ –¥–∏–∞–ª–æ–≥–µ —Å –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–º –∫–ª–∏–µ–Ω—Ç–æ–º.</p>
                    </div>
                    <div class="bg-white rounded-lg shadow-md border border-gray-200 p-6 mb-8">
                        <h4 class="text-xl font-bold text-gray-800 mb-4">1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å—Ü–µ–Ω–∞—Ä–∏—è</h4>
                        <div class="space-y-4">
                            <div>
                                <label for="scenario-input" class="block text-sm font-medium text-gray-700 mb-1">–û–ø–∏—à–∏—Ç–µ –∫–ª–∏–µ–Ω—Ç–∞:</label>
                                <input type="text" id="scenario-input" class="w-full border border-gray-300 rounded-lg px-3 py-2" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –º–æ–ª–æ–¥–∞—è —Å–µ–º—å—è –∏—â–µ—Ç –≤–Ω–µ–¥–æ—Ä–æ–∂–Ω–∏–∫">
                            </div>
                            <div class="flex items-center gap-4">
                                <button id="create-scenario-btn" class="bg-blue-600 text-white font-semibold px-5 py-2 rounded-lg hover:bg-blue-700">–°–æ–∑–¥–∞—Ç—å</button>
                                <button id="random-scenario-btn" class="bg-gray-200 text-gray-800 font-semibold px-5 py-2 rounded-lg hover:bg-gray-300">‚ú® –°–ª—É—á–∞–π–Ω—ã–π</button>
                            </div>
                        </div>
                        <div id="scenario-output" class="mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg text-blue-800 hidden"></div>
                    </div>
                    <div id="dialogue-card" class="card bg-white rounded-lg shadow-md border border-gray-200 overflow-hidden">
                        <div class="card-header p-6 flex justify-between items-center">
                            <h4 class="text-xl font-bold text-gray-800">2. –î–∏–∞–ª–æ–≥ —Å –∫–ª–∏–µ–Ω—Ç–æ–º</h4>
                            <span class="chevron text-2xl text-blue-500">‚ñº</span>
                        </div>
                        <div class="card-content">
                            <div id="chat-window" class="p-4 h-96 overflow-y-auto flex flex-col space-y-4"></div>
                            <div class="p-4 border-t border-gray-200 flex items-center gap-2">
                                <input type="text" id="chat-input" class="flex-grow border border-gray-300 rounded-lg px-4 py-2" placeholder="–ù–∞—á–Ω–∏—Ç–µ –¥–∏–∞–ª–æ–≥..." disabled>
                                <button id="improve-chat-btn" class="bg-yellow-400 text-yellow-900 font-semibold px-4 py-2 rounded-lg hover:bg-yellow-500 disabled:bg-gray-400" disabled title="–£–ª—É—á—à–∏—Ç—å –æ—Ç–≤–µ—Ç —Å –ø–æ–º–æ—â—å—é –ò–ò">‚ú®</button>
                                <button id="chat-send" class="bg-blue-600 text-white font-semibold px-6 py-2 rounded-lg disabled:bg-gray-400" disabled>–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
                                <button id="end-chat-btn" class="bg-red-500 text-white font-semibold px-6 py-2 rounded-lg hover:bg-red-600 disabled:bg-gray-400" disabled>–ó–∞–≤–µ—Ä—à–∏—Ç—å</button>
                            </div>
                        </div>
                    </div>
                </section>
                
                <section id="analysis-section" class="scroll-mt-10 pt-10">
                     <div class="mb-8">
                        <h3 class="text-3xl font-bold text-gray-800 mb-2">üìä –ê–Ω–∞–ª–∏–∑ –¥–∏–∞–ª–æ–≥–∞</h3>
                        <p class="text-gray-600 leading-relaxed">–ü–æ–ª—É—á–∏—Ç–µ –ø–æ–¥—Ä–æ–±–Ω—ã–π —Ä–∞–∑–±–æ—Ä –≤–∞—à–µ–≥–æ –¥–∏–∞–ª–æ–≥–∞ —Å –ò–ò-—Ç—Ä–µ–Ω–∞–∂–µ—Ä–∞.</p>
                    </div>
                    <div class="bg-white rounded-lg shadow-md border border-gray-200 p-6 mb-8">
                        <h4 class="text-xl font-bold text-gray-800 mb-4">–†–µ–∑—É–ª—å—Ç–∞—Ç –¥–∏–∞–ª–æ–≥–∞ –∏–∑ —Ç—Ä–µ–Ω–∞–∂–µ—Ä–∞</h4>
                        <div id="analysis-output" class="mt-2 hidden">
                            <div id="analysis-result-content" class="p-4 bg-gray-50 border rounded-lg space-y-4"></div>
                            <button id="restart-btn" class="mt-4 bg-blue-600 text-white font-semibold px-5 py-2 rounded-lg hover:bg-blue-700">–ù–∞—á–∞—Ç—å –æ–±—É—á–µ–Ω–∏–µ —Å–Ω–∞—á–∞–ª–∞</button>
                        </div>
                         <p id="analysis-placeholder" class="text-gray-500">–ó–¥–µ—Å—å –ø–æ—è–≤–∏—Ç—Å—è –∞–Ω–∞–ª–∏–∑ –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –¥–∏–∞–ª–æ–≥–∞ –≤ –ò–ò-—Ç—Ä–µ–Ω–∞–∂–µ—Ä–µ.</p>
                    </div>
                </section>

                <section id="library-section" class="scroll-mt-10 pt-10">
                    <div class="mb-8">
                        <h3 class="text-3xl font-bold text-gray-800 mb-2">üìö –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –≤–æ–∑—Ä–∞–∂–µ–Ω–∏–π</h3>
                        <p class="text-gray-600 leading-relaxed">–ì–æ—Ç–æ–≤—ã–µ –æ—Ç–≤–µ—Ç—ã –Ω–∞ –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ –≤–æ–∑—Ä–∞–∂–µ–Ω–∏—è.</p>
                    </div>
                    <div class="bg-white rounded-lg shadow-md border border-gray-200 p-6 mb-8">
                        <label for="objection-select" class="block text-lg font-medium text-gray-700 mb-3">–í—ã–±–µ—Ä–∏—Ç–µ –≤–æ–∑—Ä–∞–∂–µ–Ω–∏–µ –∏–∑ —Å–ø–∏—Å–∫–∞:</label>
                        <select id="objection-select" class="w-full border border-gray-300 rounded-lg px-3 py-2 text-base focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </select>
                        <div id="objection-answer" class="mt-4 border-t pt-4 min-h-[150px]">
                        </div>
                    </div>
                </section>
                
                <section id="objection-generator-section" class="scroll-mt-10 pt-10">
                     <div class="mb-8">
                        <h3 class="text-3xl font-bold text-gray-800 mb-2">‚ú® –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –≤–æ–∑—Ä–∞–∂–µ–Ω–∏–π</h3>
                        <p class="text-gray-600 leading-relaxed">–ü–æ–ª—É—á–∏—Ç–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –æ—Ç–≤–µ—Ç–∞ –Ω–∞ –ª—é–±–æ–µ, –¥–∞–∂–µ —Å–∞–º–æ–µ –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω–æ–µ, –≤–æ–∑—Ä–∞–∂–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞.</p>
                    </div>
                    <div class="bg-white rounded-lg shadow-md border border-gray-200 p-6">
                        <h4 class="text-xl font-bold text-gray-800 mb-4">–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –æ—Ç–≤–µ—Ç–∞ –Ω–∞ –ª—é–±–æ–µ –≤–æ–∑—Ä–∞–∂–µ–Ω–∏–µ</h4>
                        <div>
                            <label for="custom-objection-input" class="block text-sm font-medium text-gray-700 mb-1">–í–≤–µ–¥–∏—Ç–µ –≤–æ–∑—Ä–∞–∂–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞, —Å –∫–æ—Ç–æ—Ä—ã–º –≤—ã —Å—Ç–æ–ª–∫–Ω—É–ª–∏—Å—å:</label>
                            <input type="text" id="custom-objection-input" class="w-full border border-gray-300 rounded-lg px-3 py-2" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: '–ü–æ—á–µ–º—É —É –≤–∞—Å –Ω–µ—Ç —Ç—Ä–µ–π–¥-–∏–Ω?'">
                        </div>
                        <button id="generate-objection-response-btn" class="mt-3 bg-blue-600 text-white font-semibold px-5 py-2 rounded-lg hover:bg-blue-700">–ü–æ–ª—É—á–∏—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –æ—Ç–≤–µ—Ç–∞</button>
                        <div id="custom-objection-output" class="mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg hidden"></div>
                    </div>
                </section>
                
                <section id="knowledge-section" class="scroll-mt-10 pt-10">
                    <div class="mb-8">
                        <h3 class="text-3xl font-bold text-gray-800 mb-2">üß† –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π</h3>
                        <p class="text-gray-600 leading-relaxed">–ó–∞–∫—Ä–µ–ø–∏—Ç–µ —Ç–µ–æ—Ä–∏—é –Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ: —Ä–∞–∑–±–µ—Ä–∏—Ç–µ —Ä–µ–∞–ª—å–Ω—ã–µ –∫–µ–π—Å—ã –∏ –ø—Ä–æ–π–¥–∏—Ç–µ —Ç–µ—Å—Ç.</p>
                    </div>
                    
                    <div class="bg-white rounded-lg shadow-md border border-gray-200 p-6 mb-8">
                        <h4 class="text-2xl font-bold text-gray-800 mb-4">–ö–µ–π—Å—ã –∏–∑ –ø—Ä–∞–∫—Ç–∏–∫–∏</h4>
                        <div class="space-y-4">
                            <p><strong>–ö–µ–π—Å 1: "–ü—Ä–æ–¥–∞–∂–∞ —á–µ—Ä–µ–∑ –≤–∏–¥–µ–æ".</strong> –ö–ª–∏–µ–Ω—Ç —Å–æ–º–Ω–µ–≤–∞–ª—Å—è, —Å—Ç–æ–∏—Ç –ª–∏ –µ—Ö–∞—Ç—å 200 –∫–º —Ä–∞–¥–∏ –æ—Å–º–æ—Ç—Ä–∞. –ú–µ–Ω–µ–¥–∂–µ—Ä –∑–∞–ø–∏—Å–∞–ª –∫–æ—Ä–æ—Ç–∫–æ–µ –≤–∏–¥–µ–æ —Å –æ–±—Ö–æ–¥–æ–º –º–∞—à–∏–Ω—ã, –ø–æ–∫–∞–∑–∞–ª –∑–∞–ø—É—Å–∫ –¥–≤–∏–≥–∞—Ç–µ–ª—è –∏ —Ä–∞–±–æ—Ç—É —Ñ–∞—Ä. –ö–ª–∏–µ–Ω—Ç –ø—Ä–∏–µ—Ö–∞–ª –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å –∏ –∫—É–ø–∏–ª –∞–≤—Ç–æ–º–æ–±–∏–ª—å, —Å–∫–∞–∑–∞–≤, —á—Ç–æ "–≤–∏–¥–µ–æ —Å–Ω—è–ª–æ 90% –µ–≥–æ —Å–æ–º–Ω–µ–Ω–∏–π".</p>
                            <p class="border-t pt-4 mt-4"><strong>–ö–µ–π—Å 2: "–ö–∞—Ä—Ç–∞ —Ä–∏—Å–∫–æ–≤".</strong> –°–µ–º—å—è —Å –¥–µ—Ç—å–º–∏ –∏—Å–∫–∞–ª–∞ –º–∏–Ω–∏–≤—ç–Ω. –ö–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç –Ω–∞—á–∞–ª –¥–∏–∞–ª–æ–≥ —Å –≤–æ–ø—Ä–æ—Å–∞: "–ß—Ç–æ –≤–∞—Å –±–æ–ª—å—à–µ –≤—Å–µ–≥–æ –ø—É–≥–∞–µ—Ç –≤ –ø–æ–∫—É–ø–∫–µ –±–æ–ª—å—à–æ–≥–æ –±/—É –∞–≤—Ç–æ–º–æ–±–∏–ª—è?". –ö–ª–∏–µ–Ω—Ç—ã —Ä–∞—Å—Å–∫–∞–∑–∞–ª–∏ –æ —Å—Ç—Ä–∞—Ö–µ —Å–∫—Ä—ã—Ç—ã—Ö –ø—Ä–æ–±–ª–µ–º —Å –¥–≤–∏–≥–∞—Ç–µ–ª–µ–º. –ú–µ–Ω–µ–¥–∂–µ—Ä —Å–∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–ª –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—é –Ω–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö —ç–Ω–¥–æ—Å–∫–æ–ø–∏–∏ –∏ –≥–∞—Ä–∞–Ω—Ç–∏–∏ –Ω–∞ –î–í–°, —á—Ç–æ —Å—Ç–∞–ª–æ —Ä–µ—à–∞—é—â–∏–º —Ñ–∞–∫—Ç–æ—Ä–æ–º.</p>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-lg shadow-md border border-gray-200 p-6 mb-8">
                        <h4 class="text-2xl font-bold text-gray-800 mb-4">‚ú® –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —É—á–µ–±–Ω—ã—Ö –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤</h4>
                         <div class="space-y-4">
                            <div>
                                <label for="learning-topic-input" class="block text-sm font-medium text-gray-700 mb-1">–ó–∞–¥–∞–π—Ç–µ —Ç–µ–º—É:</label>
                                <input type="text" id="learning-topic-input" class="w-full border border-gray-300 rounded-lg px-3 py-2" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –∫–ª–∏–µ–Ω—Ç —Ç–æ—Ä–≥—É–µ—Ç—Å—è –¥–æ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ">
                            </div>
                            <div class="flex flex-wrap gap-3 mt-2">
                                <button data-type="case" class="generate-learning-btn bg-blue-600 text-white font-semibold px-5 py-2 rounded-lg hover:bg-blue-700">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–µ–π—Å</button>
                                <button data-type="scenario" class="generate-learning-btn bg-green-600 text-white font-semibold px-5 py-2 rounded-lg hover:bg-green-700">–°—Ü–µ–Ω–∞—Ä–∏–π –¥–ª—è —Ä–æ–ª–ø–ª–µ—è</button>
                                <button data-type="mistakes" class="generate-learning-btn bg-yellow-500 text-white font-semibold px-5 py-2 rounded-lg hover:bg-yellow-600">–¢–æ–ø-3 –æ—à–∏–±–∫–∏</button>
                            </div>
                        </div>
                          <div id="learning-material-output" class="mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg text-blue-800 hidden"></div>
                          <div id="learning-material-controls" class="flex gap-3 mt-4 hidden">
                            <button id="collapse-learning-btn" class="text-sm bg-gray-200 text-gray-800 font-semibold px-4 py-2 rounded-lg hover:bg-gray-300">–°–≤–µ—Ä–Ω—É—Ç—å</button>
                            <button id="clear-learning-btn" class="text-sm bg-red-100 text-red-800 font-semibold px-4 py-2 rounded-lg hover:bg-red-200">–û—á–∏—Å—Ç–∏—Ç—å</button>
                          </div>
                    </div>
                    
                    <div id="mistakes-section" class="bg-white rounded-lg shadow-md border border-gray-200 p-6 mb-8 scroll-mt-10">
                        <h4 class="text-2xl font-bold text-gray-800 mb-4">üö´ –†–∞–∑–±–æ—Ä —á–∞—Å—Ç—ã—Ö –æ—à–∏–±–æ–∫</h4>
                        <div class="space-y-4">
                            <label for="mistake-select" class="block text-lg font-medium text-gray-700 mb-2">–í—ã–±–µ—Ä–∏—Ç–µ –æ—à–∏–±–∫—É –∏–∑ —Å–ø–∏—Å–∫–∞:</label>
                            <select id="mistake-select" class="w-full border border-gray-300 rounded-lg px-3 py-2 text-base focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </select>
                            <div id="mistake-explanation" class="mt-4 border-t pt-4 min-h-[200px]">
                            </div>
                        </div>
                    </div>

                    <div id="quiz-section" class="card bg-white rounded-lg shadow-md border border-gray-200 overflow-hidden scroll-mt-10">
                        <div class="card-header p-5 flex justify-between items-center">
                            <h4 class="text-2xl font-bold text-gray-800">–¢–µ—Å—Ç –Ω–∞ –∑–Ω–∞–Ω–∏–µ —Ç–µ—Ö–Ω–∏–∫</h4>
                             <div class="flex items-center gap-4">
                                <button id="generate-quiz-btn" class="bg-gray-200 text-gray-800 font-semibold px-5 py-2 rounded-lg hover:bg-gray-300 text-sm">‚ú® –ù–æ–≤—ã–π —Ç–µ—Å—Ç</button>
                                <span class="chevron text-2xl text-blue-500">‚ñº</span>
                             </div>
                        </div>
                        <div class="card-content">
                             <div class="px-5 pb-5 border-t border-gray-200">
                                <p class="text-gray-600 mt-4">–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–≤–æ–∏ –∑–Ω–∞–Ω–∏—è. –£ –≤–∞—Å –µ—Å—Ç—å –ø—Ä–∞–≤–æ –Ω–∞ 2 –æ—à–∏–±–∫–∏. –¢—Ä–µ—Ç—å—è –æ—à–∏–±–∫–∞ ‚Äî –∏ —Ç–µ—Å—Ç –Ω–∞—á–Ω–µ—Ç—Å—è –∑–∞–Ω–æ–≤–æ.</p>
                                <div id="mistakes-counter" class="mt-2 font-semibold">–û—à–∏–±–æ–∫: 0 / 2</div>
                                <div id="quiz-container" class="space-y-3 mt-4">
                                </div>
                                <div id="quiz-final-results" class="mt-6 pt-4 border-t text-center font-bold hidden">
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
                
            </main>
        </div>
    </div>
    
    <div id="feedback-modal" class="modal-overlay">
        <div class="modal-content">
            <h3 class="text-xl font-bold text-red-700 mb-3">–ù–µ–≤–µ—Ä–Ω–æ</h3>
            <div id="modal-explanation" class="text-gray-700 mb-4">
            </div>
            <button id="close-modal-btn" class="bg-blue-600 text-white font-semibold px-5 py-2 rounded-lg w-full hover:bg-blue-700">–ü–æ–Ω—è—Ç–Ω–æ</button>
        </div>
    </div>

    <button id="back-to-top" title="Go to top">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18" />
        </svg>
    </button>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            
            const callGeminiAPI = async (prompt, systemInstruction = "") => {
                try {
                    const response = await fetch('/api/gemini', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ prompt, systemInstruction }),
                    });
                    if (!response.ok) {
                        const errorText = await response.text();
                        console.error("API Error:", errorText);
                        throw new Error(`API responded with status: ${response.status}`);
                    }
                    const result = await response.json();
                    return result.text;
                } catch (error) {
                    console.error("Failed to call API:", error);
                    return "–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –Ω–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –æ—Ç–≤–µ—Ç –æ—Ç –ò–ò-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –æ—à–∏–±–æ–∫.";
                }
            };

            const stagesData = [
                {
                    id: "stage1",
                    title: "–≠—Ç–∞–ø 1: –¶–∏—Ñ—Ä–æ–≤–æ–µ —Ä—É–∫–æ–ø–æ–∂–∞—Ç–∏–µ ‚Äì —Å–æ–∑–¥–∞–Ω–∏–µ –¥–æ–≤–µ—Ä–∏—è –¥–æ –≤—Å—Ç—Ä–µ—á–∏",
                    icon: "ü§ù",
                    description: "–ü–µ—Ä–≤–æ–µ –≤–ø–µ—á–∞—Ç–ª–µ–Ω–∏–µ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è –∑–∞–¥–æ–ª–≥–æ –¥–æ —Ç–æ–≥–æ, –∫–∞–∫ –∫–ª–∏–µ–Ω—Ç –ø–µ—Ä–µ—Å—Ç—É–ø–∏—Ç –ø–æ—Ä–æ–≥ –≤–∞—à–µ–≥–æ —Å–∞–ª–æ–Ω–∞. –í–∞—à–∞ –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É –∏–ª–∏ –≤ –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–µ –∑–∞–¥–∞–µ—Ç —Ç–æ–Ω –≤—Å–µ–π —Å–¥–µ–ª–∫–µ.",
                    techniques: [
                        { title: "üé• –¢–µ—Ö–Ω–∏–∫–∞: '–í–∏–¥–µ–æ-–∑–Ω–∞–∫–æ–º—Å—Ç–≤–æ'", works: "–í—Å—Ç–∞–Ω—å—Ç–µ —Ä—è–¥–æ–º —Å –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–º, –∫–æ—Ç–æ—Ä—ã–π –∑–∞–∏–Ω—Ç–µ—Ä–µ—Å–æ–≤–∞–ª –∫–ª–∏–µ–Ω—Ç–∞, –∏ –∑–∞–ø–∏—à–∏—Ç–µ –∫–æ—Ä–æ—Ç–∫–æ–µ (–¥–æ 60 —Å–µ–∫—É–Ω–¥) –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –≤–∏–¥–µ–æ.", quote: "–ò–≤–∞–Ω, –¥–æ–±—Ä—ã–π –¥–µ–Ω—å! –≠—Ç–æ [–≤–∞—à–µ –∏–º—è]. –°–Ω–∏–º–∞—é –¥–ª—è –≤–∞—Å —Ç–æ—Ç —Å–∞–º—ã–π Passat. –ú–∞—à–∏–Ω–∞ —á–∏—Å—Ç–∞—è, –∂–¥–µ—Ç –≤–∞—Å. –ü—Ä–∏–µ–∑–∂–∞–π—Ç–µ –∑–∞–≤—Ç—Ä–∞ –∫ 11, –≤—Å–µ –ø–æ–∫–∞–∂—É, –ø—Ä–æ–∫–∞—Ç–∏–º—Å—è. –î–æ —Å–≤—è–∑–∏!", why: ["<strong>–ü—Ä–æ–±–∏–≤–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–π —à—É–º:</strong> –í—ã–¥–µ–ª—è–µ—Ç—Å—è –Ω–∞ —Ñ–æ–Ω–µ –¥–µ—Å—è—Ç–∫–æ–≤ –±–µ–∑–ª–∏–∫–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π.", "<strong>–°–æ–∑–¥–∞–µ—Ç –ª–∏—á–Ω—É—é —Å–≤—è–∑—å:</strong> –ö–ª–∏–µ–Ω—Ç –≤–∏–¥–∏—Ç –∂–∏–≤–æ–≥–æ —á–µ–ª–æ–≤–µ–∫–∞, –∞ –Ω–µ –ø—Ä–æ—Å—Ç–æ –ø—Ä–æ–¥–∞–≤—Ü–∞.", "<strong>–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å:</strong> –û–Ω –≤–∏–¥–∏—Ç —Ä–µ–∞–ª—å–Ω—ã–π –∞–≤—Ç–æ–º–æ–±–∏–ª—å, –∞ –Ω–µ –ø—Ä–æ—Å—Ç–æ —Ñ–æ—Ç–æ –∏–∑ –æ–±—ä—è–≤–ª–µ–Ω–∏—è. –î–æ–≤–µ—Ä–∏–µ –≤–æ–∑—Ä–∞—Å—Ç–∞–µ—Ç –Ω–∞ –ø–æ—Ä—è–¥–æ–∫."] },
                        { title: "‚ú® –¢–µ—Ö–Ω–∏–∫–∞: '–ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å –∫–∞–∫ —Å–µ—Ä–≤–∏—Å'", works: "–ù–∞ –ø–µ—Ä–≤–æ–º –∂–µ –∑–≤–æ–Ω–∫–µ –¥–µ–π—Å—Ç–≤—É–π—Ç–µ –Ω–∞ –æ–ø–µ—Ä–µ–∂–µ–Ω–∏–µ –∏ —Å–∞–º–∏ —Ä–∞—Å—Å–∫–∞–∂–∏—Ç–µ –æ –º–µ–ª–∫–∏—Ö –Ω–µ–¥–æ—Å—Ç–∞—Ç–∫–∞—Ö. –≠—Ç–æ –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ–±–µ–∑–æ—Ä—É–∂–∏–≤–∞–µ—Ç –∫–ª–∏–µ–Ω—Ç–∞.", quote: "–ú–∞—à–∏–Ω–∞ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏ –≤ –ø–æ–ª–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ, –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É —Å–¥–µ–ª–∞–ª–∏. –°—Ä–∞–∑—É —Å–∫–∞–∂—É, —á—Ç–æ–±—ã –≤—Å—ë –±—ã–ª–æ –ø–æ-—á–µ—Å—Ç–Ω–æ–º—É: –Ω–∞ –∑–∞–¥–Ω–µ–º –±–∞–º–ø–µ—Ä–µ –µ—Å—Ç—å –ø–∞—Ä–∞ —Ü–∞—Ä–∞–ø–∏–Ω, —è –∏—Ö —Å—Ä–∞–∑—É –ø–æ–∫–∞–∂—É. –í –æ—Å—Ç–∞–ª—å–Ω–æ–º ‚Äî –≤—Å—ë —á–∏—Å—Ç–æ, –ø–æ —Ç–µ—Ö–Ω–∏–∫–µ –≤–æ–ø—Ä–æ—Å–æ–≤ –Ω–µ—Ç.", why: ["–í—ã –ª–æ–º–∞–µ—Ç–µ —à–∞–±–ª–æ–Ω '–ø—Ä–æ–¥–∞–≤–µ—Ü –≤—Å–µ–≥–¥–∞ —á—Ç–æ-—Ç–æ —Å–∫—Ä—ã–≤–∞–µ—Ç'. –ö–ª–∏–µ–Ω—Ç –ø–æ–Ω–∏–º–∞–µ—Ç, —á—Ç–æ –æ—Ç –Ω–µ–≥–æ –Ω–∏—á–µ–≥–æ –Ω–µ —É—Ç–∞–∏–≤–∞—é—Ç, –∏ –Ω–∞—á–∏–Ω–∞–µ—Ç –¥–æ–≤–µ—Ä—è—Ç—å –∏ —Ç–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏, –≥–¥–µ –≤—ã —Ö–≤–∞–ª–∏—Ç–µ –∞–≤—Ç–æ–º–æ–±–∏–ª—å."] }
                    ]
                },
                {
                    id: "stage2",
                    title: "–≠—Ç–∞–ø 2: –ü–µ—Ä–≤—ã–µ 5 –º–∏–Ω—É—Ç ‚Äì —Ä–∞–∑–æ—Ä–≤–∞—Ç—å —à–∞–±–ª–æ–Ω –æ–∂–∏–¥–∞–Ω–∏—è",
                    icon: "‚è±Ô∏è",
                    description: "–ö–ª–∏–µ–Ω—Ç –ø—Ä–∏—Ö–æ–¥–∏—Ç –≤ —Å–∞–ª–æ–Ω, –≥–æ—Ç–æ–≤—ã–π –∫ –æ–±–æ—Ä–æ–Ω–µ. –û–Ω –∂–¥–µ—Ç –¥–∞–≤–ª–µ–Ω–∏—è, —É–ª–æ–≤–æ–∫ –∏ –Ω–∞–≤—è–∑—á–∏–≤—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤. –í–∞—à–∞ –∑–∞–¥–∞—á–∞ ‚Äî –≤ –ø–µ—Ä–≤—ã–µ –º–∏–Ω—É—Ç—ã –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–∑—Ä—É—à–∏—Ç—å —ç—Ç–æ—Ç —Å—Ç–µ—Ä–µ–æ—Ç–∏–ø.",
                    techniques: [
                        { title: "üéØ –¢–µ—Ö–Ω–∏–∫–∞: '–ó–∞—è–≤–ª–µ–Ω–∏–µ –æ –Ω–∞–º–µ—Ä–µ–Ω–∏—è—Ö'", works: "–í–º–µ—Å—Ç–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ '–ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å?', –Ω–∞—á–Ω–∏—Ç–µ –≤—Å—Ç—Ä–µ—á—É —Å —á–µ—Å—Ç–Ω–æ–≥–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –≤–∞—à–µ–π —Ä–æ–ª–∏.", quote: "–ò–≤–∞–Ω, —Ä–∞–¥ –≤–∞—Å –≤–∏–¥–µ—Ç—å. –ú–æ—è –∑–∞–¥–∞—á–∞ –ø—Ä–æ—Å—Ç–∞—è ‚Äî –ø–æ–º–æ—á—å –≤–∞–º —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è –≤ —ç—Ç–æ–π –º–∞—à–∏–Ω–µ, —á—Ç–æ–±—ã –≤—ã –ø—Ä–∏–Ω—è–ª–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –¥–ª—è —Å–µ–±—è —Ä–µ—à–µ–Ω–∏–µ, –∫–∞–∫–∏–º –±—ã –æ–Ω–æ –Ω–∏ –±—ã–ª–æ. –ù–∏–∫–∞–∫–æ–≥–æ –¥–∞–≤–ª–µ–Ω–∏—è. –î–∞–≤–∞–π—Ç–µ —Å–ø–æ–∫–æ–π–Ω–æ –≤—Å—ë –ø–æ—Å–º–æ—Ç—Ä–∏–º.", why: ["–í—ã –º–≥–Ω–æ–≤–µ–Ω–Ω–æ —Å–Ω–∏–∂–∞–µ—Ç–µ —É—Ä–æ–≤–µ–Ω—å —Å—Ç—Ä–µ—Å—Å–∞ —É –∫–ª–∏–µ–Ω—Ç–∞. –û–Ω –ø–æ–Ω–∏–º–∞–µ—Ç, —á—Ç–æ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ–π —Å—Ä–µ–¥–µ, –≥–¥–µ –µ–≥–æ –≤—ã–±–æ—Ä —É–≤–∞–∂–∞—é—Ç. –û–Ω –∏–∑ '–∂–µ—Ä—Ç–≤—ã' –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ '–ø–∞—Ä—Ç–Ω–µ—Ä–∞ –ø–æ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—é'."] },
                        { title: "üéÆ –¢–µ—Ö–Ω–∏–∫–∞: '–û—Ç–¥–∞—Ç—å –∫–æ–Ω—Ç—Ä–æ–ª—å'", works: "–ü–æ–∑–≤–æ–ª—å—Ç–µ –∫–ª–∏–µ–Ω—Ç—É —Å–∞–º–æ–º—É –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Å—Ü–µ–Ω–∞—Ä–∏–π –≤—Å—Ç—Ä–µ—á–∏.", quote: "–° —á–µ–≥–æ –≤–∞–º —É–¥–æ–±–Ω–µ–µ –Ω–∞—á–∞—Ç—å? –ú–æ–∂–µ–º —Å –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤, –º–æ–∂–µ–º —Å—Ä–∞–∑—É –∫ –º–∞—à–∏–Ω–µ. –ò–ª–∏, –º–æ–∂–µ—Ç, —É –≤–∞—Å –µ—Å—Ç—å —Å–≤–æ–∏ –≤–æ–ø—Ä–æ—Å—ã?", why: ["–ß–µ–ª–æ–≤–µ–∫, –∫–æ—Ç–æ—Ä—ã–π —á—É–≤—Å—Ç–≤—É–µ—Ç –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ —Å–∏—Ç—É–∞—Ü–∏–µ–π, –±–æ–ª–µ–µ –æ—Ç–∫—Ä—ã—Ç –∏ —Ä–∞—Å—Å–ª–∞–±–ª–µ–Ω. –í—ã –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç–µ, —á—Ç–æ —ç—Ç–æ '–µ–≥–æ' –≤—Å—Ç—Ä–µ—á–∞, –∞ –Ω–µ '–≤–∞—à–∞' –ø—Ä–æ–¥–∞–∂–∞."] }
                    ]
                },
                {
                    id: "stage3",
                    title: "–≠—Ç–∞–ø 3: –°–æ–≤–º–µ—Å—Ç–Ω–æ–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ",
                    icon: "üîç",
                    description: "–ó–∞–±—É–¥—å—Ç–µ –±–∞–Ω–∞–ª—å–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã '–î–ª—è —á–µ–≥–æ –≤–∞–º –º–∞—à–∏–Ω–∞?'. –ö–æ–ø–∞–π—Ç–µ –≥–ª—É–±–∂–µ, —á—Ç–æ–±—ã –ø–æ–Ω—è—Ç—å –Ω–µ –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—å, –∞ –º–µ—á—Ç—É, —Å—Ç—Ä–∞—Ö –∏ –∂–∏–∑–Ω–µ–Ω–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π –∫–ª–∏–µ–Ω—Ç–∞.",
                    techniques: [
                        { title: "üöÄ –¢–µ—Ö–Ω–∏–∫–∞: '–í–æ–ø—Ä–æ—Å—ã –æ –±—É–¥—É—â–µ–º'", works: "–í–º–µ—Å—Ç–æ —Ç–æ–≥–æ —á—Ç–æ–±—ã –≥–æ–≤–æ—Ä–∏—Ç—å –æ –ø—Ä–æ—à–ª–æ–º, –≥–æ–≤–æ—Ä–∏—Ç–µ –æ –±—É–¥—É—â–µ–º, –∫–æ—Ç–æ—Ä–æ–µ –ø–æ–¥–∞—Ä–∏—Ç –∞–≤—Ç–æ–º–æ–±–∏–ª—å.", quote: "–î–∞–≤–∞–π—Ç–µ –Ω–∞ —Å–µ–∫—É–Ω–¥—É –æ—Ç–≤–ª–µ—á–µ–º—Å—è. –ü—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ, –≤—ã –Ω–∞—à–ª–∏ —Å–≤–æ—é –∏–¥–µ–∞–ª—å–Ω—É—é –º–∞—à–∏–Ω—É. –ù–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —ç—Ç—É. –ö–∞–∫ –∏–∑–º–µ–Ω–∏–ª–∞—Å—å –±—ã –≤–∞—à–∞ –∂–∏–∑–Ω—å —á–µ—Ä–µ–∑ –ø–æ–ª–≥–æ–¥–∞? –ö–∞–∫–∏–µ –ø–æ–µ–∑–¥–∫–∏, —ç–º–æ—Ü–∏–∏ –ø–æ—è–≤–∏–ª–∏—Å—å –±—ã?", why: ["–í—ã –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç–µ –∫–ª–∏–µ–Ω—Ç–∞ —Å –ª–æ–≥–∏—á–µ—Å–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ (—Ü–µ–Ω–∞, –ø—Ä–æ–±–µ–≥) –Ω–∞ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å. –í—ã –ø—Ä–æ–¥–∞–µ—Ç–µ –Ω–µ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω–æ–µ —Å—Ä–µ–¥—Å—Ç–≤–æ, –∞ <strong>–±—É–¥—É—â–∏–π –æ–ø—ã—Ç</strong>. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–Ω—è—Ç—å –µ–≥–æ –∏—Å—Ç–∏–Ω–Ω—ã–µ –º–æ—Ç–∏–≤–∞—Ç–æ—Ä—ã (–∫–æ–º—Ñ–æ—Ä—Ç, —Å—Ç–∞—Ç—É—Å, –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å, —Å–≤–æ–±–æ–¥–∞)."] },
                        { title: "üõ°Ô∏è –¢–µ—Ö–Ω–∏–∫–∞: '–ö–∞—Ä—Ç–∞ —Ä–∏—Å–∫–æ–≤'", works: "–û—Ç–∫—Ä—ã—Ç–æ —Å–ø—Ä–æ—Å–∏—Ç–µ –æ —Å—Ç—Ä–∞—Ö–∞—Ö –∫–ª–∏–µ–Ω—Ç–∞. –≠—Ç–æ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç –≤–∞—Å –∫–∞–∫ –µ–≥–æ –∑–∞—â–∏—Ç–Ω–∏–∫–∞.", quote: "–î–∞–≤–∞–π—Ç–µ –Ω–∞—á–∏—Å—Ç–æ—Ç—É, —á—Ç–æ –±–æ–ª—å—à–µ –≤—Å–µ–≥–æ –Ω–∞–ø—Ä—è–≥–∞–µ—Ç –ø—Ä–∏ –ø–æ–∫—É–ø–∫–µ –±/—É –º–∞—à–∏–Ω—ã? –ú–æ–∂–µ—Ç, –±—ã–ª –Ω–µ—É–¥–∞—á–Ω—ã–π –æ–ø—ã—Ç? –†–∞—Å—Å–∫–∞–∂–∏—Ç–µ, —á—Ç–æ–±—ã –º—ã —Ç–æ—á–Ω–æ –≤—Å—ë –ø—Ä–æ–≤–µ—Ä–∏–ª–∏ –∏ —ç—Ç–∏ –º–æ–º–µ–Ω—Ç—ã –∏—Å–∫–ª—é—á–∏–ª–∏.", why: ["–í—ã –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç–µ, —á—Ç–æ –ø–æ–Ω–∏–º–∞–µ—Ç–µ —Ä–∏—Å–∫–∏ –∏ –≥–æ—Ç–æ–≤—ã –ø–æ–º–æ—á—å –∏—Ö –º–∏–Ω–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å. –í—ã —Å—Ç–∞–Ω–æ–≤–∏—Ç–µ—Å—å –µ–≥–æ —Å–æ—é–∑–Ω–∏–∫–æ–º –ø—Ä–æ—Ç–∏–≤ '–ø–ª–æ—Ö–æ–≥–æ' –∞–≤—Ç–æ—Ä—ã–Ω–∫–∞."] }
                    ]
                },
                {
                    id: "stage4",
                    title: "–≠—Ç–∞–ø 4: –î–æ–∫–∞–∑–∞—Ç–µ–ª—å–Ω–∞—è –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—è",
                    icon: "üìÑ",
                    description: "–ü—Ä–µ–∫—Ä–∞—Ç–∏—Ç–µ –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ—á–∏—Å–ª—è—Ç—å –æ–ø—Ü–∏–∏. –ü—Ä–µ–≤—Ä–∞—Ç–∏—Ç–µ –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—é –∞–≤—Ç–æ–º–æ–±–∏–ª—è –≤ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—é –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤ –µ–≥–æ —Ü–µ–Ω–Ω–æ—Å—Ç–∏.",
                    techniques: [
                        { title: "üìÇ –¢–µ—Ö–Ω–∏–∫–∞: '–ü—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—è —á–µ—Ä–µ–∑ –¥–æ–∫—É–º–µ–Ω—Ç—ã'", works: "–ù–∞—á–Ω–∏—Ç–µ –æ—Å–º–æ—Ç—Ä –Ω–µ —É –∫–∞–ø–æ—Ç–∞, –∞ –≤ –æ—Ñ–∏—Å–µ –∑–∞ —Å—Ç–æ–ª–æ–º, —Ä–∞–∑–ª–æ–∂–∏–≤ –ø–µ—Ä–µ–¥ –∫–ª–∏–µ–Ω—Ç–æ–º –≤—Å—é –∏—Å—Ç–æ—Ä–∏—é –∞–≤—Ç–æ–º–æ–±–∏–ª—è.", quote: "–ü—Ä–µ–¥–ª–∞–≥–∞—é –Ω–∞—á–∞—Ç—å –Ω–µ —Å –∂–µ–ª–µ–∑–∞, –∞ —Å –∏—Å—Ç–æ—Ä–∏–∏. –í–æ—Ç —Å–º–æ—Ç—Ä–∏—Ç–µ: –ê–≤—Ç–æ—Ç–µ–∫–∞ ‚Äî —á–∏—Å—Ç–∞—è, –±–µ–∑ —Å–µ—Ä—å–µ–∑–Ω—ã—Ö –î–¢–ü. –í–æ—Ç –∑–∞–∫–∞–∑-–Ω–∞—Ä—è–¥—ã —Å –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –¢–û, –ø–æ–º–µ–Ω—è–ª–∏ –≤—Å—ë —á—Ç–æ –Ω—É–∂–Ω–æ. –ê –≤–æ—Ç –Ω–∞—à–∞ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ ‚Äî —Ç–æ—Ä–º–æ–∑–æ–≤ –µ—â–µ –Ω–∞ 80% —Ö–≤–∞—Ç–∏—Ç.", why: ["–í—ã —Å–æ–∑–¥–∞–µ—Ç–µ —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç –¥–æ–≤–µ—Ä–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ñ–∞–∫—Ç–æ–≤ –∏ —Ü–∏—Ñ—Ä. –ö –º–æ–º–µ–Ω—Ç—É, –∫–æ–≥–¥–∞ –∫–ª–∏–µ–Ω—Ç –ø–æ–¥—Ö–æ–¥–∏—Ç –∫ –∞–≤—Ç–æ–º–æ–±–∏–ª—é, –æ–Ω —É–∂–µ –ø–æ–¥—Å–æ–∑–Ω–∞—Ç–µ–ª—å–Ω–æ —É–≤–µ—Ä–µ–Ω –≤ –µ–≥–æ —Ö–æ—Ä–æ—à–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏."] },
                        { title: "ü§´ –¢–µ—Ö–Ω–∏–∫–∞: '–ú–æ–ª—á–∞–ª–∏–≤—ã–π —Ç–µ—Å—Ç-–¥—Ä–∞–π–≤'", works: "–ù–∞ —Ç–µ—Å—Ç-–¥—Ä–∞–π–≤–µ –¥–∞–π—Ç–µ –∞–≤—Ç–æ–º–æ–±–∏–ª—é —Å–∞–º–æ–º—É '–ø—Ä–æ–¥–∞—Ç—å' —Å–µ–±—è.", quote: "–î–∞–≤–∞–π—Ç–µ —è —Å–µ–π—á–∞—Å –ø–æ–º–æ–ª—á—É, –∞ –≤—ã –ø—Ä–æ—Å—Ç–æ –ø–æ—á—É–≤—Å—Ç–≤—É–µ—Ç–µ –º–∞—à–∏–Ω—É. –ö–∞–∫ –æ–Ω–∞ –µ–¥–µ—Ç, –∫–∞–∫ —Ä—É–ª–∏—Ç—Å—è. –°–æ—Å—Ä–µ–¥–æ—Ç–æ—á—å—Ç–µ—Å—å –Ω–∞ —Å–≤–æ–∏—Ö –æ—â—É—â–µ–Ω–∏—è—Ö.", why: ["–í—ã –¥–∞–µ—Ç–µ –∫–ª–∏–µ–Ω—Ç—É –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—É—é —Å–≤—è–∑—å —Å –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–º –±–µ–∑ –≤–∞—à–µ–≥–æ –Ω–∞–≤—è–∑—á–∏–≤–æ–≥–æ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è. –û—â—É—â–µ–Ω–∏–µ '–º–æ–µ–π –º–∞—à–∏–Ω—ã' —Ä–æ–∂–¥–∞–µ—Ç—Å—è –∏–º–µ–Ω–Ω–æ –≤ —Ç–∞–∫–∏–µ –º–æ–º–µ–Ω—Ç—ã."] }
                    ]
                },
                {
                    id: "stage5",
                    title: "–≠—Ç–∞–ø 5: –ù–∞–≤–∏–≥–∞—Ü–∏—è –≤ –ø–µ—Ä–µ–≥–æ–≤–æ—Ä–∞—Ö –æ —Ü–µ–Ω–Ω–æ—Å—Ç–∏",
                    icon: "üí∞",
                    description: "–¢–æ—Ä–≥ ‚Äî —ç—Ç–æ –Ω–µ –±–∏—Ç–≤–∞ –∑–∞ —Å–∫–∏–¥–∫—É. –≠—Ç–æ —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —ç—Ç–∞–ø –æ–±—Å—É–∂–¥–µ–Ω–∏—è —Ü–µ–Ω–Ω–æ—Å—Ç–∏ —Å–¥–µ–ª–∫–∏.",
                    techniques: [
                        { title: "üíé –¢–µ—Ö–Ω–∏–∫–∞: '–Ø–∫–æ—Ä–µ–Ω–∏–µ –Ω–∞ —Ü–µ–Ω–Ω–æ—Å—Ç–∏'", works: "–ö–æ–≥–¥–∞ –∫–ª–∏–µ–Ω—Ç –ø—Ä–æ—Å–∏—Ç —Å–∫–∏–¥–∫—É, –Ω–µ –æ—Ç–≤–µ—á–∞–π—Ç–µ '–¥–∞' –∏–ª–∏ '–Ω–µ—Ç'. –í–µ—Ä–Ω–∏—Ç–µ —Ä–∞–∑–≥–æ–≤–æ—Ä –∫ —Ç–æ–π —Ü–µ–Ω–Ω–æ—Å—Ç–∏, –∫–æ—Ç–æ—Ä—É—é –≤—ã —É–∂–µ –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–ª–∏.", quote: "<strong>–ö–ª–∏–µ–Ω—Ç:</strong> '–ü–æ —Ü–µ–Ω–µ –¥–≤–∏–≥–∞—Ç—å—Å—è –±—É–¥–µ—Ç–µ?'\n<strong>–í—ã:</strong> '–ü–æ–Ω–∏–º–∞—é. –î–∞–≤–∞–π—Ç–µ –ø—Ä–∏–∫–∏–Ω–µ–º –µ—â–µ —Ä–∞–∑, –∑–∞ —á—Ç–æ –º—ã –ø–ª–∞—Ç–∏–º. –ö—Ä–æ–º–µ —Å–∞–º–æ–π –º–∞—à–∏–Ω—ã, –∑–¥–µ—Å—å —Å–≤–µ–∂–µ–µ –¢–û –Ω–∞ 45 —Ç—ã—Å—è—á –∏ –Ω–∞—à–∞ –≥–æ–¥–æ–≤–∞—è –≥–∞—Ä–∞–Ω—Ç–∏—è. –ü–æ —Å—É—Ç–∏, –≤—ã –ø–æ–∫—É–ø–∞–µ—Ç–µ —Å–ø–æ–∫–æ–π—Å—Ç–≤–∏–µ –Ω–∞ –≥–æ–¥ –≤–ø–µ—Ä–µ–¥. –° —É—á–µ—Ç–æ–º —ç—Ç–æ–≥–æ —Ü–µ–Ω–∞ —á–µ—Å—Ç–Ω–∞—è.'", why: ["–í—ã —Å–º–µ—â–∞–µ—Ç–µ —Ñ–æ–∫—É—Å —Å '–æ—Ç–Ω—è—Ç—å –æ—Ç —Ü–µ–Ω—ã' –Ω–∞ '–ø–æ–Ω—è—Ç—å, –∑–∞ —á—Ç–æ —è –ø–ª–∞—á—É'. –ö–ª–∏–µ–Ω—Ç—É –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏ —Å–ª–æ–∂–Ω–æ –æ–±–µ—Å—Ü–µ–Ω–∏—Ç—å —Ç–µ –≤—ã–≥–æ–¥—ã, —Å –∫–æ—Ç–æ—Ä—ã–º–∏ –æ–Ω —Ç–æ–ª—å–∫–æ —á—Ç–æ —Å–æ–≥–ª–∞—Å–∏–ª—Å—è."] },
                        { title: "‚ùì –¢–µ—Ö–Ω–∏–∫–∞: '–£—Å–ª–æ–≤–Ω–æ–µ —Å–æ–≥–ª–∞—Å–∏–µ'", works: "–ü—Ä–µ–∂–¥–µ —á–µ–º –æ–±—Å—É–∂–¥–∞—Ç—å —Å–∫–∏–¥–∫—É, –≤—ã—è—Å–Ω–∏—Ç–µ, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —Ü–µ–Ω–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–º –∏ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–º –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–µ–º.", quote: "–•–æ—Ä–æ—à–æ, –¥–∞–≤–∞–π—Ç–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–∏–º. –ï—Å–ª–∏ —è —Å–º–æ–≥—É –¥–æ–≥–æ–≤–æ—Ä–∏—Ç—å—Å—è –ø–æ —Ü–µ–Ω–µ, —ç—Ç–æ –±—É–¥–µ—Ç —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –≤–æ–ø—Ä–æ—Å, –∏–ª–∏ –µ—Å—Ç—å —á—Ç–æ-—Ç–æ –µ—â–µ, —á—Ç–æ –≤–∞—Å —Å–º—É—â–∞–µ—Ç?", why: ["–≠—Ç–æ—Ç –≤–æ–ø—Ä–æ—Å ‚Äî –ª–∞–∫–º—É—Å–æ–≤–∞—è –±—É–º–∞–∂–∫–∞. –ï—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç –≥–æ–≤–æ—Ä–∏—Ç '–¥–∞', –≤—ã –ø–æ–Ω–∏–º–∞–µ—Ç–µ, —á—Ç–æ –Ω–∞—Ö–æ–¥–∏—Ç–µ—Å—å –Ω–∞ —Ñ–∏–Ω–∏—à–Ω–æ–π –ø—Ä—è–º–æ–π. –ï—Å–ª–∏ –æ–Ω –≥–æ–≤–æ—Ä–∏—Ç '–Ω—É, –º–Ω–µ –µ—â–µ –Ω–∞–¥–æ –ø–æ–¥—É–º–∞—Ç—å...', –∑–Ω–∞—á–∏—Ç, —Ä–µ–∞–ª—å–Ω–æ–µ –≤–æ–∑—Ä–∞–∂–µ–Ω–∏–µ –Ω–µ –≤ —Ü–µ–Ω–µ, –∏ –≤—ã –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç–µ—Å—å –∫ –µ–≥–æ –ø—Ä–æ—Ä–∞–±–æ—Ç–∫–µ."] }
                    ]
                },
                {
                    id: "stage6",
                    title: "–≠—Ç–∞–ø 6: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–æ–∑—Ä–∞–∂–µ–Ω–∏—è–º–∏",
                    icon: "‚úÖ",
                    description: "–í–æ–∑—Ä–∞–∂–µ–Ω–∏–µ ‚Äî —ç—Ç–æ –Ω–µ –æ—Ç–∫–∞–∑, –∞ —Å–∫—Ä—ã—Ç—ã–π –≤–æ–ø—Ä–æ—Å, —Ç—Ä–µ–±—É—é—â–∏–π –æ—Ç–≤–µ—Ç–∞. –ù–∞—É—á–∏—Ç–µ—Å—å –≤–∏–¥–µ—Ç—å –≤ –Ω–∏—Ö –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –¥–ª—è —É–≥–ª—É–±–ª–µ–Ω–∏—è –¥–æ–≤–µ—Ä–∏—è.",
                    techniques: [
                        { title: "üß† –¢–µ—Ö–Ω–∏–∫–∞: '–ó–µ—Ä–∫–∞–ª—å–Ω–æ–µ –æ—Ç—Ä–∞–∂–µ–Ω–∏–µ'", works: "–ê–∫–∫—É—Ä–∞—Ç–Ω–æ –ø–æ–≤—Ç–æ—Ä–∏—Ç–µ –≤–æ–∑—Ä–∞–∂–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞, —á—Ç–æ–±—ã –ø–æ–∫–∞–∑–∞—Ç—å, —á—Ç–æ –≤—ã –µ–≥–æ —É—Å–ª—ã—à–∞–ª–∏, –∏ –≤—ã–∏–≥—Ä–∞—Ç—å –≤—Ä–µ–º—è –Ω–∞ –æ–±–¥—É–º—ã–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞.", quote: "'–ú–∞—à–∏–Ω–∞ —Å–ª–∏—à–∫–æ–º –¥–æ—Ä–æ–≥–∞—è...' &mdash; '–¢–æ –µ—Å—Ç—å, –≤—ã —Å—á–∏—Ç–∞–µ—Ç–µ, —á—Ç–æ —Ü–µ–Ω–∞ –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ü–µ–Ω–Ω–æ—Å—Ç–∏?'<br>'–ú–Ω–µ –Ω–∞–¥–æ –ø–æ–¥—É–º–∞—Ç—å...' &mdash; '–ü—Ä–∞–≤–∏–ª—å–Ω–æ –ª–∏ —è –≤–∞—Å –ø–æ–Ω—è–ª, –≤–∞–º –Ω—É–∂–Ω–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è, —á—Ç–æ–±—ã –ø—Ä–∏–Ω—è—Ç—å —Ä–µ—à–µ–Ω–∏–µ?'", why: ["<strong>–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —ç–º–ø–∞—Ç–∏—é:</strong> –í—ã –¥–æ–∫–∞–∑—ã–≤–∞–µ—Ç–µ, —á—Ç–æ –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ —Å–ª—É—à–∞–ª–∏.", "<strong>–£–±–∏—Ä–∞–µ—Ç –∞–≥—Ä–µ—Å—Å–∏—é:</strong> –ö–ª–∏–µ–Ω—Ç –≤–∏–¥–∏—Ç, —á—Ç–æ –≤—ã –Ω–µ —Å–ø–æ—Ä–∏—Ç–µ, –∞ —Ö–æ—Ç–∏—Ç–µ —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è –≤ —Å–∏—Ç—É–∞—Ü–∏–∏.", "<strong>–í—ã—è–≤–ª—è–µ—Ç –∏—Å—Ç–∏–Ω–Ω—É—é –ø—Ä–∏—á–∏–Ω—É:</strong> –ß–∞—Å—Ç–æ –∑–∞ –æ–¥–Ω–∏–º –≤–æ–∑—Ä–∞–∂–µ–Ω–∏–µ–º –∫—Ä–æ–µ—Ç—Å—è —Å–æ–≤—Å–µ–º –¥—Ä—É–≥–æ–µ, –∏ —ç—Ç–æ—Ç –º–µ—Ç–æ–¥ –ø–æ–º–æ–≥–∞–µ—Ç –µ–≥–æ –æ–±–Ω–∞—Ä—É–∂–∏—Ç—å."] },
                        { title: "‚öñÔ∏è –¢–µ—Ö–Ω–∏–∫–∞: '–í–µ—Å—ã —Ä–µ—à–µ–Ω–∏—è'", works: "–ù–∞–≥–ª—è–¥–Ω–æ –ø–æ–∫–∞–∂–∏—Ç–µ –∫–ª–∏–µ–Ω—Ç—É, –∫–∞–∫ –≤—ã–≥–æ–¥—ã –æ—Ç –ø–æ–∫—É–ø–∫–∏ –ø–µ—Ä–µ–≤–µ—à–∏–≤–∞—é—Ç –µ–≥–æ —Å–æ–º–Ω–µ–Ω–∏—è. –í—ã –º–æ–∂–µ—Ç–µ —Å–¥–µ–ª–∞—Ç—å —ç—Ç–æ –Ω–∞ –±—É–º–∞–≥–µ –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ –≤ –¥–∏–∞–ª–æ–≥–µ.", quote: "–ò–≤–∞–Ω, –¥–∞–≤–∞–π—Ç–µ —Ç–∞–∫. –ù–∞ –æ–¥–Ω–æ–π —á–∞—à–µ –≤–µ—Å–æ–≤ ‚Äî –≤–∞—à–∞ –∑–∞–±–æ—Ç–∞ –æ —Å–µ–º—å–µ (–º—ã –≤–µ–¥—å —Å–º–æ—Ç—Ä–µ–ª–∏ —ç—Ç–æ—Ç –±–æ–ª—å—à–æ–π –≤–Ω–µ–¥–æ—Ä–æ–∂–Ω–∏–∫ –¥–ª—è –ø–æ–µ–∑–¥–æ–∫ –∑–∞ –≥–æ—Ä–æ–¥, –≤–µ—Ä–Ω–æ?) –∏ –Ω–∞—à–µ –≥–æ–¥–æ–≤–æ–µ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ. –ù–∞ –¥—Ä—É–≥–æ–π ‚Äî –Ω–µ–±–æ–ª—å—à–∞—è —Ü–∞—Ä–∞–ø–∏–Ω–∞ –Ω–∞ –±–∞–º–ø–µ—Ä–µ. –ß—Ç–æ –¥–ª—è –≤–∞—Å –≤–∞–∂–Ω–µ–µ?", why: ["<strong>–í–∏–∑—É–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Ü–µ–Ω–Ω–æ—Å—Ç—å:</strong> –ö–ª–∏–µ–Ω—Ç –Ω–∞—á–∏–Ω–∞–µ—Ç –≤–∏–¥–µ—Ç—å –Ω–µ —Ç–æ–ª—å–∫–æ –º–∏–Ω—É—Å—ã, –Ω–æ –∏ —è–≤–Ω—ã–µ, –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –ø–ª—é—Å—ã.", "<strong>–°–º–µ—â–∞–µ—Ç —Ñ–æ–∫—É—Å:</strong> –†–∞–∑–≥–æ–≤–æ—Ä —É—Ö–æ–¥–∏—Ç –æ—Ç '–Ω–µ–¥–æ—Å—Ç–∞—Ç–∫–æ–≤' –∫ '–ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞–º'.", "<strong>–ü–æ–∑–≤–æ–ª—è–µ—Ç –∫–ª–∏–µ–Ω—Ç—É –ø—Ä–∏–Ω—è—Ç—å —Ä–µ—à–µ–Ω–∏–µ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ:</strong> –í—ã –Ω–µ –¥–∞–≤–∏—Ç–µ, –∞ –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç–µ –µ–º—É —Å–∞–º–æ–º—É —Ä–∞—Å—Å—Ç–∞–≤–∏—Ç—å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã."] }
                    ]
                },
                {
                    id: "stage7",
                    title: "–≠—Ç–∞–ø 7: –ó–∞–∫—Ä—ã—Ç–∏–µ —Å–¥–µ–ª–∫–∏",
                    icon: "üèÅ",
                    description: "–§–∏–Ω–∞–ª—å–Ω—ã–π —à–∞–≥, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–º –≤—ã –ø–æ–º–æ–≥–∞–µ—Ç–µ –∫–ª–∏–µ–Ω—Ç—É –ø—Ä–∏–Ω—è—Ç—å –æ–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω–æ–µ, —É–≤–µ—Ä–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ. –í–∞—à–∞ –∑–∞–¥–∞—á–∞ ‚Äî –Ω–µ '–¥–æ–∂–∞—Ç—å', –∞ –ª–æ–≥–∏—á–Ω–æ –∑–∞–≤–µ—Ä—à–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å —Å–æ–≤–º–µ—Å—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã.",
                    techniques: [
                        { title: "üéØ –¢–µ—Ö–Ω–∏–∫–∞: '–í—ã–±–æ—Ä –±–µ–∑ –≤—ã–±–æ—Ä–∞'", works: "–ó–∞–¥–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç, —á—Ç–æ —Ä–µ—à–µ–Ω–∏–µ –æ –ø–æ–∫—É–ø–∫–µ —É–∂–µ –ø—Ä–∏–Ω—è—Ç–æ, –∏ –ø–µ—Ä–µ–≤–æ–¥–∏—Ç —Ñ–æ–∫—É—Å –Ω–∞ –¥–µ—Ç–∞–ª–∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è.", quote: "'–û—Ç–ª–∏—á–Ω–æ, —Ç–æ–≥–¥–∞ –∫–∞–∫ –≤–∞–º –±—É–¥–µ—Ç —É–¥–æ–±–Ω–µ–µ: –Ω–∞—á–Ω–µ–º –æ—Ñ–æ—Ä–º–ª—è—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç—ã –∏–ª–∏ —Å–Ω–∞—á–∞–ª–∞ –ø–æ—Å—Ç–∞–≤–∏–º –º–∞—à–∏–Ω—É –Ω–∞ –ø–æ–¥–≥–æ—Ç–æ–≤–∫—É?'", why: ["–°–Ω–∏–∂–∞–µ—Ç —Å—Ç—Ä–µ—Å—Å –ø—Ä–∏–Ω—è—Ç–∏—è –≥–ª–∞–≤–Ω–æ–≥–æ —Ä–µ—à–µ–Ω–∏—è. –ö–ª–∏–µ–Ω—Ç—É –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏ –ø—Ä–æ—â–µ –≤—ã–±—Ä–∞—Ç—å –º–µ–∂–¥—É –¥–≤—É–º—è –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º–∏ —Å—Ü–µ–Ω–∞—Ä–∏—è–º–∏, —á–µ–º –º–µ–∂–¥—É '–∫—É–ø–∏—Ç—å' –∏ '–Ω–µ –∫—É–ø–∏—Ç—å'."] },
                        { title: "ü§ù –¢–µ—Ö–Ω–∏–∫–∞: '–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥'", works: "–ï—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç –≤—Å–µ –µ—â–µ —Å–æ–º–Ω–µ–≤–∞–µ—Ç—Å—è, –Ω–µ –¥–∞–≤–∏—Ç–µ, –∞ —á–µ—Ç–∫–æ –∏ —è—Å–Ω–æ –ø—Ä–æ–≥–æ–≤–æ—Ä–∏—Ç–µ —Å–ª–µ–¥—É—é—â–∏–π –ø—Ä–æ—Å—Ç–æ–π —à–∞–≥.", quote: "'–ü–æ–Ω–∏–º–∞—é, –Ω—É–∂–Ω–æ –≤—Å–µ –≤–∑–≤–µ—Å–∏—Ç—å. –î–∞–≤–∞–π—Ç–µ —Å–¥–µ–ª–∞–µ–º —Ç–∞–∫: —è —Å–µ–π—á–∞—Å –∑–∞–±—Ä–æ–Ω–∏—Ä—É—é –¥–ª—è –≤–∞—Å —ç—Ç–æ—Ç –∞–≤—Ç–æ–º–æ–±–∏–ª—å –¥–æ –∑–∞–≤—Ç—Ä–∞—à–Ω–µ–≥–æ —É—Ç—Ä–∞, —ç—Ç–æ –≤–∞—Å –Ω–∏ –∫ —á–µ–º—É –Ω–µ –æ–±—è–∑—ã–≤–∞–µ—Ç. –ê –≤—ã —Å–º–æ–∂–µ—Ç–µ —Å–ø–æ–∫–æ–π–Ω–æ –≤—Å–µ –æ–±–¥—É–º–∞—Ç—å –∏ —É—Ç—Ä–æ–º –¥–∞—Ç—å –æ—Ç–≤–µ—Ç. –°–æ–≥–ª–∞—Å–Ω—ã?'", why: ["–í—ã —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç–µ –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤—É, –Ω–µ –≤—ã–≥–ª—è–¥—è –Ω–∞–≤—è–∑—á–∏–≤—ã–º. –≠—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤–∞—à—É —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –∏ –∑–∞–±–æ—Ç—É –æ –∫–æ–º—Ñ–æ—Ä—Ç–µ –∫–ª–∏–µ–Ω—Ç–∞, –æ—Å—Ç–∞–≤–ª—è—è –¥–≤–µ—Ä—å –æ—Ç–∫—Ä—ã—Ç–æ–π –∏ —Å–Ω–∏–º–∞—è —Å –Ω–µ–≥–æ –¥–∞–≤–ª–µ–Ω–∏–µ –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞."] }
                    ]
                }
            ];

            const stagesContainer = document.getElementById("stages-container");
            if(stagesContainer){
                stagesData.forEach(stage => {
                    const section = document.createElement("section");
                    section.id = stage.id;
                    section.className = "scroll-mt-10 pt-10";

                    let techniquesHtml = "";
                    stage.techniques.forEach(tech => {
                        techniquesHtml += `
                            <div class="card bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden">
                                <div class="card-header p-5 flex justify-between items-center">
                                    <h4 class="text-xl font-bold text-gray-800">${tech.title}</h4>
                                    <span class="chevron text-2xl text-blue-500">‚ñº</span>
                                </div>
                                <div class="card-content">
                                    <div class="px-5 pb-5 border-t border-gray-200">
                                        <h5 class="font-bold mt-4 mb-2 text-gray-700">–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:</h5>
                                        <p class="text-gray-600 mb-4">${tech.works}</p>
                                        <blockquote>${tech.quote.replace(/\n/g, "<br>")}</blockquote>
                                        <h5 class="font-bold mt-4 mb-2 text-gray-700">–ü–æ—á–µ–º—É —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:</h5>
                                        <ul class="list-disc list-inside space-y-2 text-gray-600">${Array.isArray(tech.why) ? tech.why.map(item => `<li>${item}</li>`).join("") : `<li>${tech.why}</li>`}</ul>
                                    </div>
                                </div>
                            </div>`;
                    });

                    section.innerHTML = `
                        <div class="mb-8">
                            <h3 class="text-3xl font-bold text-gray-800 mb-2">${stage.icon} ${stage.title}</h3>
                            <p class="text-gray-600 leading-relaxed">${stage.description}</p>
                        </div>
                        <div class="space-y-4">${techniquesHtml}</div>`;
                    stagesContainer.appendChild(section);
                });
            }

            const mainElement = document.querySelector('main');
            if (mainElement) {
                mainElement.addEventListener("click", function (event) {
                    const cardHeader = event.target.closest(".card-header");
                    if (cardHeader) {
                        cardHeader.parentElement.classList.toggle("open");
                    }
                });
            }

            const navToggle = document.querySelector('.nav-toggle');
            if (navToggle) {
                navToggle.querySelector('.nav-link-parent').addEventListener('click', () => {
                    navToggle.classList.toggle('open');
                });
            }

            const navLinks = document.querySelectorAll(".nav-link");
            const sections = document.querySelectorAll("main section");

            const observer = new IntersectionObserver(entries => {
                let activeFound = false;
                entries.forEach(entry => {
                    const id = entry.target.id;
                    const link = document.querySelector(`a[href="#${id}"]`);
                    if (entry.isIntersecting && entry.intersectionRatio >= 0.2 && !activeFound) {
                         navLinks.forEach(nav => nav.classList.remove('active'));
                         if(link) {
                            link.classList.add('active');
                            const parentToggle = link.closest('.nav-toggle');
                            if (parentToggle && !parentToggle.classList.contains('open')) {
                                parentToggle.classList.add('open');
                            }
                            activeFound = true;
                         }
                    }
                });
            }, { rootMargin: "-40% 0px -60% 0px", threshold: 0.2 });

            sections.forEach(section => {
                if(section) observer.observe(section);
            });

            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function(e) {
                    e.preventDefault();
                    const targetElement = document.querySelector(this.getAttribute('href'));
                    if(targetElement) {
                        targetElement.scrollIntoView({
                            behavior: 'smooth'
                        });
                    }
                });
            });
            
            const chatWindow = document.getElementById("chat-window");
            const chatInput = document.getElementById("chat-input");
            const chatSendBtn = document.getElementById("chat-send");
            const improveChatBtn = document.getElementById("improve-chat-btn");
            const scenarioInput = document.getElementById("scenario-input");
            const createScenarioBtn = document.getElementById("create-scenario-btn");
            const randomScenarioBtn = document.getElementById("random-scenario-btn");
            const scenarioOutput = document.getElementById("scenario-output");
            const endChatBtn = document.getElementById("end-chat-btn");
            const analysisOutput = document.getElementById("analysis-output");
            const analysisResultContent = document.getElementById("analysis-result-content");
            const analysisPlaceholder = document.getElementById("analysis-placeholder");
            const restartBtn = document.getElementById("restart-btn");

            let conversationHistory = "";
            let currentScenarioSystemPrompt = "";

            const addMessage = (text, sender) => {
                if (!chatWindow) return;
                const messageEl = document.createElement("div");
                messageEl.className = `chat-bubble ${sender === 'user' ? 'user-bubble' : 'ai-bubble'}`;
                messageEl.textContent = text;
                chatWindow.appendChild(messageEl);
                chatWindow.scrollTop = chatWindow.scrollHeight;
            };

            const resetChat = () => {
                if(chatWindow) chatWindow.innerHTML = "";
                conversationHistory = "";
                if(chatInput) chatInput.disabled = true;
                if(chatSendBtn) chatSendBtn.disabled = true;
                if(improveChatBtn) improveChatBtn.disabled = true;
                if(endChatBtn) endChatBtn.disabled = true;
                if(chatInput) chatInput.value = "";
            };

            const resetAll = () => {
                resetChat();
                if(scenarioOutput) {
                    scenarioOutput.textContent = "";
                    scenarioOutput.classList.add("hidden");
                }
                if(analysisOutput) analysisOutput.classList.add("hidden");
                if(analysisPlaceholder) analysisPlaceholder.classList.remove("hidden");
                if(analysisResultContent) analysisResultContent.innerHTML = "";
                window.scrollTo({ top: 0, behavior: "smooth" });
            };
            
            const generateAndStartScenario = async (prompt = "") => {
                resetChat();
                if(scenarioOutput) {
                    scenarioOutput.classList.remove("hidden");
                    scenarioOutput.innerHTML = '<div class="loader mx-auto"></div>';
                }
                if(createScenarioBtn) createScenarioBtn.disabled = true;
                if(randomScenarioBtn) randomScenarioBtn.disabled = true;
                
                const dialogueCard = document.getElementById('dialogue-card');
                if (dialogueCard) dialogueCard.classList.add('open');
                
                const systemPrompt = "–¢—ã ‚Äî –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –¥–ª—è —Ç—Ä–µ–Ω–∞–∂–µ—Ä–∞ –ø–æ –ø—Ä–æ–¥–∞–∂–∞–º. –°–æ–∑–¥–∞–π –∫—Ä–∞—Ç–∫–∏–π (2-3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è) —Å—Ü–µ–Ω–∞—Ä–∏–π-–ø–µ—Ä—Å–æ–Ω—É –¥–ª—è —Ä–æ–ª–µ–≤–æ–π –∏–≥—Ä—ã –ø–æ –ø—Ä–æ–¥–∞–∂–µ –±/—É –∞–≤—Ç–æ. –£–∫–∞–∂–∏ –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–∏, —Ö–∞—Ä–∞–∫—Ç–µ—Ä –∏ –≤–æ–∑–º–æ–∂–Ω—ã–µ –≤–æ–∑—Ä–∞–∂–µ–Ω–∏—è. –ù–∞—á–∏–Ω–∞–π –æ—Ç–≤–µ—Ç —Å–æ —Å–ª–æ–≤ '–í–∞—à –∫–ª–∏–µ–Ω—Ç:'.";
                const userPrompt = prompt ? `–°–æ–∑–¥–∞–π —Å—Ü–µ–Ω–∞—Ä–∏–π –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏: "${prompt}"` : "–°–æ–∑–¥–∞–π —Å–ª—É—á–∞–π–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π –¥–ª—è –ø—Ä–æ–¥–∞–∂–∏ –±/—É –∞–≤—Ç–æ–º–æ–±–∏–ª—è.";
                
                const scenarioText = await callGeminiAPI(userPrompt, systemPrompt);
                if(scenarioOutput) scenarioOutput.textContent = scenarioText;
                
                currentScenarioSystemPrompt = `–¢—ã ‚Äî –ò–ò-—Å–æ–±–µ—Å–µ–¥–Ω–∏–∫ –≤ —Ç—Ä–µ–Ω–∞–∂–µ—Ä–µ –ø–æ –ø—Ä–æ–¥–∞–∂–∞–º. –¢–≤–æ—è –∑–∞–¥–∞—á–∞ ‚Äî –æ—Ç—ã–≥—Ä—ã–≤–∞—Ç—å —Ä–æ–ª—å –∫–ª–∏–µ–Ω—Ç–∞ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å–æ —Å—Ü–µ–Ω–∞—Ä–∏–µ–º. –ì–æ–≤–æ—Ä–∏ –ø—Ä–æ—Å—Ç–æ, –ø–æ-—á–µ–ª–æ–≤–µ—á–µ—Å–∫–∏, –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ, –∫–æ—Ä–æ—Ç–∫–∏–º–∏ —Ñ—Ä–∞–∑–∞–º–∏. –ë—É–¥—å –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–º –≤ —Å–≤–æ–µ–π —Ä–æ–ª–∏. –°—Ü–µ–Ω–∞—Ä–∏–π: "${scenarioText}"`;
                
                addMessage("–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å?", "user");
                conversationHistory = `–ü—Ä–æ–¥–∞–≤–µ—Ü: –ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å?`;

                const firstReplyPrompt = `–ù–∞ –æ—Å–Ω–æ–≤–µ —ç—Ç–æ–≥–æ —Å—Ü–µ–Ω–∞—Ä–∏—è: "${scenarioText}", –Ω–∞–ø–∏—à–∏ –æ–¥–Ω—É –∫–æ—Ä–æ—Ç–∫—É—é, –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—É—é —Å—Ç–∞—Ä—Ç–æ–≤—É—é —Ñ—Ä–∞–∑—É –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞, –∫–æ—Ç–æ—Ä—ã–π –∑–∞—Ö–æ–¥–∏—Ç –≤ –∞–≤—Ç–æ—Å–∞–ª–æ–Ω. –¢–æ–ª—å–∫–æ —Å–∞–º–∞ —Ñ—Ä–∞–∑–∞, –±–µ–∑ –ª–∏—à–Ω–∏—Ö —Å–ª–æ–≤.`;
                const firstReply = await callGeminiAPI(firstReplyPrompt);
                
                addMessage(firstReply, "ai");
                conversationHistory += `\n–ö–ª–∏–µ–Ω—Ç: ${firstReply}`;
                
                if(chatInput) chatInput.disabled = false;
                if(chatSendBtn) chatSendBtn.disabled = false;
                if(improveChatBtn) improveChatBtn.disabled = false;
                if(endChatBtn) endChatBtn.disabled = false;
                if(chatInput) chatInput.focus();
                if(createScenarioBtn) createScenarioBtn.disabled = false;
                if(randomScenarioBtn) randomScenarioBtn.disabled = false;
            };

            if(createScenarioBtn) createScenarioBtn.addEventListener("click", () => {
                if (scenarioInput.value.trim() === "") {
                    scenarioInput.classList.add('border-red-500', 'focus:ring-red-500');
                    scenarioInput.placeholder = "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ–ø–∏—à–∏—Ç–µ –∫–ª–∏–µ–Ω—Ç–∞";
                    setTimeout(() => {
                        scenarioInput.classList.remove('border-red-500', 'focus:ring-red-500');
                        scenarioInput.placeholder = "–ù–∞–ø—Ä–∏–º–µ—Ä: –º–æ–ª–æ–¥–∞—è —Å–µ–º—å—è –∏—â–µ—Ç –≤–Ω–µ–¥–æ—Ä–æ–∂–Ω–∏–∫";
                    }, 2000);
                    return;
                }
                generateAndStartScenario(scenarioInput.value);
            });

            if(randomScenarioBtn) randomScenarioBtn.addEventListener("click", () => {
                if(scenarioInput) scenarioInput.value = "";
                generateAndStartScenario();
            });

            const handleChatSend = async () => {
                if (!chatInput || !currentScenarioSystemPrompt) return;
                const userMessage = chatInput.value.trim();
                if (!userMessage) return;
                
                addMessage(userMessage, "user");
                chatInput.value = "";
                chatInput.disabled = true;
                if(chatSendBtn) chatSendBtn.disabled = true;
                if(improveChatBtn) improveChatBtn.disabled = true;
                if(endChatBtn) endChatBtn.disabled = true;

                const loaderBubble = document.createElement("div");
                loaderBubble.className = "chat-bubble ai-bubble";
                loaderBubble.innerHTML = '<div class="loader"></div>';
                if(chatWindow) {
                    chatWindow.appendChild(loaderBubble);
                    chatWindow.scrollTop = chatWindow.scrollHeight;
                }

                conversationHistory += `\n–ü—Ä–æ–¥–∞–≤–µ—Ü: ${userMessage}`;
                
                const aiPrompt = conversationHistory + "\n–ö–ª–∏–µ–Ω—Ç:";
                const aiResponse = await callGeminiAPI(aiPrompt, currentScenarioSystemPrompt);
                
                if(chatWindow) chatWindow.removeChild(loaderBubble);
                addMessage(aiResponse, "ai");
                conversationHistory += `\n–ö–ª–∏–µ–Ω—Ç: ${aiResponse}`;

                chatInput.disabled = false;
                if(chatSendBtn) chatSendBtn.disabled = false;
                if(improveChatBtn) improveChatBtn.disabled = false;
                if(endChatBtn) endChatBtn.disabled = false;
                chatInput.focus();
            };

            if(chatSendBtn) chatSendBtn.addEventListener("click", handleChatSend);
            if(chatInput) chatInput.addEventListener("keypress", (e) => {
                if (e.key === "Enter") handleChatSend();
            });
            
            if(improveChatBtn) improveChatBtn.addEventListener('click', async () => {
                if (!chatInput) return;
                const currentText = chatInput.value.trim();
                if (!currentText) return;

                chatInput.disabled = true;
                improveChatBtn.innerHTML = '<div class="loader"></div>';

                const systemPrompt = "–¢—ã ‚Äî –ø–µ—Ä–≤–æ–∫–ª–∞—Å—Å–Ω—ã–π –∫–æ—É—á –ø–æ –ø—Ä–æ–¥–∞–∂–∞–º. –ü–µ—Ä–µ–ø–∏—à–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø—Ä–æ–¥–∞–≤—Ü–∞ –∫–ª–∏–µ–Ω—Ç—É, —á—Ç–æ–±—ã –æ–Ω–æ –∑–≤—É—á–∞–ª–æ –±–æ–ª–µ–µ —É–±–µ–¥–∏—Ç–µ–ª—å–Ω–æ, —ç–º–ø–∞—Ç–∏—á–Ω–æ –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞–ª–æ –ø—Ä–∏–Ω—Ü–∏–ø–∞–º –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ç–∏–≤–Ω—ã—Ö –ø—Ä–æ–¥–∞–∂. –û—Ç–≤–µ—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∫—Ä–∞—Ç–∫–∏–º –∏ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–º. –í–µ—Ä–Ω–∏ —Ç–æ–ª—å–∫–æ –ø–µ—Ä–µ–ø–∏—Å–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç.";
                const improvedText = await callGeminiAPI(currentText, systemPrompt);

                chatInput.value = improvedText;
                chatInput.disabled = false;
                improveChatBtn.innerHTML = '‚ú®';
                chatInput.focus();
            });

            const analyzeDialogue = async (dialogueText, outputElement) => {
                if (!outputElement) return;

                if (!dialogueText.trim()) {
                    outputElement.innerHTML = `<p class="text-red-500">–î–∏–∞–ª–æ–≥ –ø—É—Å—Ç. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞.</p>`;
                    outputElement.classList.remove("hidden");
                    return;
                }
                
                outputElement.classList.remove("hidden");
                outputElement.innerHTML = '<div class="loader mx-auto"></div>';
                
                const systemPrompt = "–¢—ã –æ–ø—ã—Ç–Ω—ã–π –∫–æ—É—á –ø–æ –ø—Ä–æ–¥–∞–∂–∞–º. –î–∞–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –æ–±—Ä–∞—Ç–Ω—É—é —Å–≤—è–∑—å –ø–æ –¥–∏–∞–ª–æ–≥—É. –†–∞–∑–¥–µ–ª–∏ –æ—Ç–∑—ã–≤ –Ω–∞ '–ß—Ç–æ –ø–æ–ª—É—á–∏–ª–æ—Å—å –æ—Ç–ª–∏—á–Ω–æ üëç' –∏ '–ù–∞–¥ —á–µ–º —Å—Ç–æ–∏—Ç –ø–æ—Ä–∞–±–æ—Ç–∞—Ç—å üöÄ'.";
                const userPrompt = `–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —ç—Ç–æ—Ç –¥–∏–∞–ª–æ–≥:\n\n${dialogueText}`;
                
                const analysisResult = await callGeminiAPI(userPrompt, systemPrompt);
                
                outputElement.innerHTML = analysisResult.replace(/\n/g, "<br>");
            };
            
            if (endChatBtn) endChatBtn.addEventListener("click", async () => {
                if(chatInput) chatInput.disabled = true;
                if(chatSendBtn) chatSendBtn.disabled = true;
                if(improveChatBtn) improveChatBtn.disabled = true;
                endChatBtn.disabled = true;
                
                if(chatInput) {
                    const finalUserMessage = chatInput.value.trim();
                    if (finalUserMessage) {
                        addMessage(finalUserMessage, "user");
                        conversationHistory += `\n–ü—Ä–æ–¥–∞–≤–µ—Ü: ${finalUserMessage}`;
                    }
                }
                if(analysisPlaceholder) analysisPlaceholder.classList.add("hidden");
                await analyzeDialogue(conversationHistory, analysisResultContent);
                if(analysisOutput) analysisOutput.classList.remove("hidden");
                const analysisLink = document.querySelector('a[href="#analysis-section"]');
                if (analysisLink) analysisLink.click();
            });

            if(restartBtn) restartBtn.addEventListener("click", resetAll);

            const objectionsData = [
                {
                    title: "–≠—Ç–æ —Å–ª–∏—à–∫–æ–º –¥–æ—Ä–æ–≥–æ",
                    strategy: '–°–º–µ—Å—Ç–∏—Ç—å —Ñ–æ–∫—É—Å —Å —Ü–µ–Ω—ã –Ω–∞ —Ü–µ–Ω–Ω–æ—Å—Ç—å.',
                    quote: '"–ü–æ–ª–Ω–æ—Å—Ç—å—é –≤–∞—Å –ø–æ–Ω–∏–º–∞—é, –≤–æ–ø—Ä–æ—Å —Ü–µ–Ω—ã ‚Äî –æ–¥–∏–Ω –∏–∑ —Å–∞–º—ã—Ö –≤–∞–∂–Ω—ã—Ö. –î–∞–≤–∞–π—Ç–µ –Ω–∞ —Å–µ–∫—É–Ω–¥—É –æ—Ç–≤–ª–µ—á–µ–º—Å—è –æ—Ç –∏—Ç–æ–≥–æ–≤–æ–π —Ü–∏—Ñ—Ä—ã –∏ –ø–æ—Å–º–æ—Ç—Ä–∏–º, —á—Ç–æ –≤ –Ω–µ–µ –≤—Ö–æ–¥–∏—Ç. –ú—ã —Å –≤–∞–º–∏ —É–±–µ–¥–∏–ª–∏—Å—å, —á—Ç–æ —É –º–∞—à–∏–Ω—ã —á–∏—Å—Ç–∞—è –∏—Å—Ç–æ—Ä–∏—è, –º—ã —Å–¥–µ–ª–∞–ª–∏ –±–æ–ª—å—à–æ–µ –¢–û –ø–µ—Ä–µ–¥ –ø—Ä–æ–¥–∞–∂–µ–π –∏ –¥–∞–µ–º –≥–æ–¥–æ–≤—É—é –≥–∞—Ä–∞–Ω—Ç–∏—é. –ü–æ —Å—É—Ç–∏, –≤—ã –ø–ª–∞—Ç–∏—Ç–µ –Ω–µ –ø—Ä–æ—Å—Ç–æ –∑–∞ –∞–≤—Ç–æ–º–æ–±–∏–ª—å, –∞ –∑–∞ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≥–æ–ª–æ–≤–Ω–æ–π –±–æ–ª–∏ –Ω–∞ –±–ª–∏–∂–∞–π—à–∏–π –≥–æ–¥. –†–∞–∑–≤–µ —ç—Ç–æ —Å–ø–æ–∫–æ–π—Å—Ç–≤–∏–µ –Ω–µ —Å—Ç–æ–∏—Ç —Å–≤–æ–∏—Ö –¥–µ–Ω–µ–≥?"'
                },
                {
                    title: "–ú–Ω–µ –Ω—É–∂–Ω–æ –ø–æ–¥—É–º–∞—Ç—å",
                    strategy: '–í—ã—è—Å–Ω–∏—Ç—å –∏—Å—Ç–∏–Ω–Ω—É—é –ø—Ä–∏—á–∏–Ω—É —Å–æ–º–Ω–µ–Ω–∏–π.',
                    quote: '"–ö–æ–Ω–µ—á–Ω–æ, —Ä–µ—à–µ–Ω–∏–µ –≤–∞–∂–Ω–æ–µ, –∏ —Å–ø–µ—à–∏—Ç—å –Ω–µ –Ω—É–∂–Ω–æ. –°–∫–∞–∂–∏—Ç–µ —á–µ—Å—Ç–Ω–æ, –µ—Å–ª–∏ –æ—Ç–±—Ä–æ—Å–∏—Ç—å –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å \'–ø–æ–¥—É–º–∞—Ç—å\', —á—Ç–æ-—Ç–æ –µ—â–µ —Å–º—É—â–∞–µ—Ç –≤ —Å–∞–º–æ–º –∞–≤—Ç–æ–º–æ–±–∏–ª–µ –∏–ª–∏ –≤ —É—Å–ª–æ–≤–∏—è—Ö? –¶–µ–Ω–∞? –ö–æ–º–ø–ª–µ–∫—Ç–∞—Ü–∏—è?"'
                },
                {
                    title: "–Ø –≤–∏–¥–µ–ª —Ç–∞–∫—É—é –∂–µ –º–∞—à–∏–Ω—É, –Ω–æ –¥–µ—à–µ–≤–ª–µ",
                    strategy: '–°—Ä–∞–≤–Ω–∏–≤–∞—Ç—å "—è–±–ª–æ–∫–∏ —Å —è–±–ª–æ–∫–∞–º–∏", –ø–æ–¥—á–µ—Ä–∫–∏–≤–∞—è –≤–∞—à–∏ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞.',
                    quote: '"–°–ø–∞—Å–∏–±–æ, —á—Ç–æ —Å–∫–∞–∑–∞–ª–∏. –ê –º–æ–∂–Ω–æ —É—Ç–æ—á–Ω–∏—Ç—å, —É —Ç–æ–≥–æ –∞–≤—Ç–æ–º–æ–±–∏–ª—è —Ç–æ–∂–µ –µ—Å—Ç—å –ø–æ–ª–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∞—è –∫–∞—Ä—Ç–∞, –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω—ã–π –ø—Ä–æ–±–µ–≥ –∏ –≥–∞—Ä–∞–Ω—Ç–∏—è –æ—Ç –¥–∏–ª–µ—Ä–∞? –ù–∞—à–∞ —Ü–µ–Ω–∞ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –≤—ã –ø—Ä–æ—Å—Ç–æ —Å–∞–¥–∏—Ç–µ—Å—å –∏ –µ–¥–µ—Ç–µ."'
                },
                {
                    title: "–ê –≤–¥—Ä—É–≥ –æ–Ω–∞ —Å–ª–æ–º–∞–µ—Ç—Å—è / –ö–∞–∫–∏–µ –≥–∞—Ä–∞–Ω—Ç–∏–∏?",
                    strategy: '–ü—Ä–æ–¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ —ç—Ç–∞–ø—ã –ø—Ä–µ–¥–ø—Ä–æ–¥–∞–∂–Ω–æ–π –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏.',
                    quote: '"–û—Ç–ª–∏—á–Ω—ã–π –≤–æ–ø—Ä–æ—Å, –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å ‚Äî —ç—Ç–æ –≥–ª–∞–≤–Ω–æ–µ. –ò–º–µ–Ω–Ω–æ –ø–æ—ç—Ç–æ–º—É –º—ã –ø—Ä–æ–≤–æ–¥–∏–º –ø–æ–ª–Ω—É—é –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É –ø–æ 100+ –ø—É–Ω–∫—Ç–∞–º. –í–æ—Ç, —Å–º–æ—Ç—Ä–∏—Ç–µ –æ—Ç—á–µ—Ç. –ü–ª—é—Å, –Ω–∞ —ç—Ç–æ—Ç –∞–≤—Ç–æ–º–æ–±–∏–ª—å –¥–µ–π—Å—Ç–≤—É–µ—Ç –Ω–∞—à–∞ –≥–æ–¥–æ–≤–∞—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –≥–∞—Ä–∞–Ω—Ç–∏—è."'
                },
                {
                    title: "–°–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π –ø—Ä–æ–±–µ–≥",
                    strategy: '–°–º–µ—Å—Ç–∏—Ç—å —Ñ–æ–∫—É—Å —Å —Ü–∏—Ñ—Ä –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ.',
                    quote: '"–Ø —Å–æ–≥–ª–∞—Å–µ–Ω, —Ü–∏—Ñ—Ä–∞ –Ω–∞ –æ–¥–æ–º–µ—Ç—Ä–µ –≤–∞–∂–Ω–∞. –ù–æ –µ—â–µ –≤–∞–∂–Ω–µ–µ, –∫–∞–∫ –∞–≤—Ç–æ–º–æ–±–∏–ª—å –æ–±—Å–ª—É–∂–∏–≤–∞–ª–∏. –≠—Ç–∞ –º–∞—à–∏–Ω–∞ –ø—Ä–æ—à–ª–∞ –≤—Å–µ –¢–û –ø–æ —Ä–µ–≥–ª–∞–º–µ–Ω—Ç—É, –≤–æ—Ç —Å–µ—Ä–≤–∏—Å–Ω–∞—è –∫–Ω–∏–∂–∫–∞. –ü–æ —Å–æ—Å—Ç–æ—è–Ω–∏—é –æ–Ω–∞ –¥–∞—Å—Ç —Ñ–æ—Ä—É –º–Ω–æ–≥–∏–º —Å –ø—Ä–æ–±–µ–≥–æ–º –ø–æ–º–µ–Ω—å—à–µ."'
                }
            ];

            const objectionSelect = document.getElementById('objection-select');
            const objectionAnswer = document.getElementById('objection-answer');

            if (objectionSelect) {
                objectionsData.forEach((objection, index) => {
                    const option = document.createElement('option');
                    option.value = index;
                    option.textContent = objection.title;
                    objectionSelect.appendChild(option);
                });
            }

            const displayObjectionAnswer = (index) => {
                const selectedObjection = objectionsData[index];
                if (selectedObjection && objectionAnswer) {
                    objectionAnswer.innerHTML = `
                        <p class="text-gray-700 mb-2"><strong>–û—Å–Ω–æ–≤–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è:</strong> ${selectedObjection.strategy}</p>
                        <blockquote>${selectedObjection.quote}</blockquote>
                    `;
                }
            };

            if (objectionSelect) {
                objectionSelect.addEventListener('change', (e) => {
                    displayObjectionAnswer(e.target.value);
                });
            }

            if(objectionsData.length > 0) {
                displayObjectionAnswer(0);
            }
            
            const customObjectionInput = document.getElementById('custom-objection-input');
            const generateObjectionResponseBtn = document.getElementById('generate-objection-response-btn');
            const customObjectionOutput = document.getElementById('custom-objection-output');

            if(generateObjectionResponseBtn) {
                generateObjectionResponseBtn.addEventListener('click', async () => {
                    const objection = customObjectionInput.value.trim();
                    if (!objection) {
                        customObjectionOutput.innerHTML = `<p class="text-red-500">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –≤–æ–∑—Ä–∞–∂–µ–Ω–∏–µ.</p>`;
                        customObjectionOutput.classList.remove('hidden');
                        return;
                    }
                    customObjectionOutput.classList.remove('hidden');
                    customObjectionOutput.innerHTML = '<div class="loader mx-auto"></div>';

                    const systemPrompt = "–¢—ã ‚Äî –∫–æ—É—á –ø–æ –ø—Ä–æ–¥–∞–∂–∞–º. –î–∞–π —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—ã–π –æ—Ç–≤–µ—Ç, –∫–∞–∫ –º–µ–Ω–µ–¥–∂–µ—Ä—É –æ—Ç—Ä–∞–±–æ—Ç–∞—Ç—å –≤–æ–∑—Ä–∞–∂–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞. –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä—É–π: 1. **–°—Ç—Ä–∞—Ç–µ–≥–∏—è:**. 2. **–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:**. 3. **–ü–æ—á–µ–º—É —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:**.";
                    const userPrompt = `–ö–∞–∫ –æ—Ç—Ä–∞–±–æ—Ç–∞—Ç—å –≤–æ–∑—Ä–∞–∂–µ–Ω–∏–µ: "${objection}"?`;
                    
                    const responseText = await callGeminiAPI(userPrompt, systemPrompt);
                    customObjectionOutput.innerHTML = responseText.replace(/\n/g, '<br>');
                });
            }
            
            const learningTopicInput = document.getElementById('learning-topic-input');
            const learningMaterialOutput = document.getElementById('learning-material-output');
            const generateLearningBtns = document.querySelectorAll('.generate-learning-btn');
            const learningMaterialControls = document.getElementById('learning-material-controls');
            const collapseLearningBtn = document.getElementById('collapse-learning-btn');
            const clearLearningBtn = document.getElementById('clear-learning-btn');

            if (generateLearningBtns) {
                generateLearningBtns.forEach(btn => {
                    btn.addEventListener('click', async () => {
                        const type = btn.dataset.type;
                        const topic = learningTopicInput.value.trim() || '–ª—é–±–∞—è —Å–ª–æ–∂–Ω–∞—è —Å–∏—Ç—É–∞—Ü–∏—è –≤ –ø—Ä–æ–¥–∞–∂–∞—Ö';
                        
                        learningMaterialOutput.classList.remove('hidden');
                        learningMaterialOutput.innerHTML = '<div class="loader mx-auto"></div>';

                        let userPrompt = "";
                        let systemPrompt = "–¢—ã ‚Äî —ç–∫—Å–ø–µ—Ä—Ç –ø–æ –æ–±—É—á–µ–Ω–∏—é –ø—Ä–æ–¥–∞–∂–∞–º. –ù–∞–ø–∏—à–∏ –º–∞—Ç–µ—Ä–∏–∞–ª –¥–ª—è –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –ø–æ –ø—Ä–æ–¥–∞–∂–∞–º –±/—É –∞–≤—Ç–æ.";

                        if (type === 'case') {
                            systemPrompt += " –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä—É–π: '**–°–∏—Ç—É–∞—Ü–∏—è:**', '**–î–µ–π—Å—Ç–≤–∏—è:**', '**–†–µ–∑—É–ª—å—Ç–∞—Ç:**'.";
                            userPrompt = `–°–æ–∑–¥–∞–π –∫–µ–π—Å –Ω–∞ —Ç–µ–º—É: "${topic}".`;
                        } else if (type === 'scenario') {
                            systemPrompt += " –û–ø–∏—à–∏ —Å—Ü–µ–Ω–∞—Ä–∏–π –¥–ª—è —Ä–æ–ª–µ–≤–æ–π –∏–≥—Ä—ã. –£–∫–∞–∂–∏ —Ä–æ–ª–∏ –∏ —Å—Ç–∞—Ä—Ç–æ–≤—É—é —Å–∏—Ç—É–∞—Ü–∏—é.";
                            userPrompt = `–°–æ–∑–¥–∞–π —Å—Ü–µ–Ω–∞—Ä–∏–π –¥–ª—è —Ä–æ–ª–µ–≤–æ–π –∏–≥—Ä—ã –Ω–∞ —Ç–µ–º—É: "${topic}".`;
                        } else if (type === 'mistakes') {
                            systemPrompt += " –°—Ñ–æ—Ä–º—É–ª–∏—Ä—É–π 3 –≥–ª–∞–≤–Ω—ã—Ö –æ—à–∏–±–∫–∏ –∏ –∫–∞–∫ –∏—Ö –∏–∑–±–µ–∂–∞—Ç—å.";
                            userPrompt = `–û–ø–∏—à–∏ —Ç–æ–ø-3 –æ—à–∏–±–∫–∏ –Ω–∞ —Ç–µ–º—É: "${topic}".`;
                        }
                        
                        const materialText = await callGeminiAPI(userPrompt, systemPrompt);
                        learningMaterialOutput.innerHTML = materialText.replace(/\n/g, '<br>');
                        
                        if (learningMaterialControls) {
                            learningMaterialControls.classList.remove('hidden');
                        }
                        if (collapseLearningBtn) {
                            collapseLearningBtn.textContent = '–°–≤–µ—Ä–Ω—É—Ç—å';
                        }
                    });
                });
            }

            if (collapseLearningBtn && learningMaterialOutput) {
                collapseLearningBtn.addEventListener('click', () => {
                    learningMaterialOutput.classList.toggle('hidden');
                    if (learningMaterialOutput.classList.contains('hidden')) {
                        collapseLearningBtn.textContent = '–†–∞–∑–≤–µ—Ä–Ω—É—Ç—å';
                    } else {
                        collapseLearningBtn.textContent = '–°–≤–µ—Ä–Ω—É—Ç—å';
                    }
                });
            }

            if (clearLearningBtn && learningTopicInput && learningMaterialOutput && learningMaterialControls) {
                clearLearningBtn.addEventListener('click', () => {
                    learningTopicInput.value = '';
                    learningMaterialOutput.innerHTML = '';
                    learningMaterialOutput.classList.add('hidden');
                    learningMaterialControls.classList.add('hidden');
                });
            }

            const mistakesData = [
                {
                    title: "–û—à–∏–±–∫–∞ 1: –ì–æ–≤–æ—Ä–∏—Ç—å, –∞ –Ω–µ —Å–ª—É—à–∞—Ç—å",
                    description: "–ú–µ–Ω–µ–¥–∂–µ—Ä '—Ç–∞—Ä–∞—Ç–æ—Ä–∏—Ç' —Å–∫—Ä–∏–ø—Ç, –Ω–µ –≤—ã—è—Å–Ω–∏–≤, —á—Ç–æ –≤–∞–∂–Ω–æ –∫–ª–∏–µ–Ω—Ç—É.",
                    tactic: "'–ü—Ä–∞–≤–∏–ª–æ 70/30'. 70% –≤—Ä–µ–º–µ–Ω–∏ –≥–æ–≤–æ—Ä–∏—Ç –∫–ª–∏–µ–Ω—Ç. –ó–∞–¥–∞–≤–∞–π—Ç–µ –æ—Ç–∫—Ä—ã—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã."
                },
                {
                    title: "–û—à–∏–±–∫–∞ 2: –°–ø–æ—Ä–∏—Ç—å —Å –∫–ª–∏–µ–Ω—Ç–æ–º",
                    description: "–ú–µ–Ω–µ–¥–∂–µ—Ä –¥–æ–∫–∞–∑—ã–≤–∞–µ—Ç, —á—Ç–æ –∫–ª–∏–µ–Ω—Ç –Ω–µ –ø—Ä–∞–≤. –≠—Ç–æ —Å–æ–∑–¥–∞–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç.",
                    tactic: "'–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Å—å, –∞ –ø–æ—Ç–æ–º –≤–µ–¥–∏'. –°–Ω–∞—á–∞–ª–∞ —Å–æ–≥–ª–∞—Å–∏—Ç–µ—Å—å —Å –º–Ω–µ–Ω–∏–µ–º –∫–ª–∏–µ–Ω—Ç–∞, –ø–æ—Ç–æ–º –ø–æ–∫–∞–∂–∏—Ç–µ –≤–∞—à–∏ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞."
                },
                {
                    title: "–û—à–∏–±–∫–∞ 3: –î–∞–≤–∏—Ç—å –∏ —Ç–æ—Ä–æ–ø–∏—Ç—å",
                    description: "–§—Ä–∞–∑—ã '–°–∫–∏–¥–∫–∞ —Ç–æ–ª—å–∫–æ —Å–µ–≥–æ–¥–Ω—è', '–ù–∞–¥–æ –±—Ä–∞—Ç—å!'. –≠—Ç–æ –≤—ã–∑—ã–≤–∞–µ—Ç –æ—Ç—Ç–æ—Ä–∂–µ–Ω–∏–µ.",
                    tactic: "'–°–æ–∑–¥–∞—Ç—å –∫–æ–º—Ñ–æ—Ä—Ç'. –ü–æ–º–æ–≥–∏—Ç–µ –∫–ª–∏–µ–Ω—Ç—É –ø—Ä–∏–Ω—è—Ç—å —É–≤–µ—Ä–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ. –ü—Ä–µ–¥–ª–æ–∂–∏—Ç–µ –∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –º–∞—à–∏–Ω—É."
                },
                {
                    title: "–û—à–∏–±–∫–∞ 4: –ù–µ –∑–Ω–∞—Ç—å —Å–≤–æ–π –ø—Ä–æ–¥—É–∫—Ç",
                    description: "–ú–µ–Ω–µ–¥–∂–µ—Ä '–ø–ª–∞–≤–∞–µ—Ç' –≤ –¥–µ—Ç–∞–ª—è—Ö –∏–ª–∏ –æ–±–º–∞–Ω—ã–≤–∞–µ—Ç. –≠—Ç–æ —É–±–∏–≤–∞–µ—Ç –¥–æ–≤–µ—Ä–∏–µ.",
                    tactic: "'–ë—ã—Ç—å —ç–∫—Å–ø–µ—Ä—Ç–æ–º'. –ò–∑—É—á–∏—Ç–µ –∏—Å—Ç–æ—Ä–∏—é –∫–∞–∂–¥–æ–≥–æ –∞–≤—Ç–æ–º–æ–±–∏–ª—è. –ï—Å–ª–∏ –Ω–µ –∑–Ω–∞–µ—Ç–µ ‚Äî —á–µ—Å—Ç–Ω–æ —Å–∫–∞–∂–∏—Ç–µ –∏ —É—Ç–æ—á–Ω–∏—Ç–µ."
                },
                {
                    title: "–û—à–∏–±–∫–∞ 5: –ü—Ä–æ–¥–∞–≤–∞—Ç—å –∞–≤—Ç–æ–º–æ–±–∏–ª—å, –∞ –Ω–µ —Ä–µ—à–µ–Ω–∏–µ",
                    description: "–§–æ–∫—É—Å –Ω–∞ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞—Ö, –∞ –Ω–µ –Ω–∞ –≤—ã–≥–æ–¥–∞—Ö –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞.",
                    tactic: "'–°–≤–æ–π—Å—Ç–≤–æ -> –í—ã–≥–æ–¥–∞'. –ö–∞–∂–¥—É—é –æ–ø—Ü–∏—é –ø–µ—Ä–µ–≤–æ–¥–∏—Ç–µ –Ω–∞ —è–∑—ã–∫ –≤—ã–≥–æ–¥—ã –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞."
                }
            ];

            const mistakeSelect = document.getElementById('mistake-select');
            const mistakeExplanation = document.getElementById('mistake-explanation');

            if (mistakeSelect && mistakeExplanation) {
                mistakesData.forEach((mistake, index) => {
                    const option = document.createElement('option');
                    option.value = index;
                    option.textContent = mistake.title;
                    mistakeSelect.appendChild(option);
                });

                const displayMistakeExplanation = (index) => {
                    const selectedMistake = mistakesData[index];
                    if (selectedMistake) {
                        mistakeExplanation.innerHTML = `
                            <h5 class="font-bold text-gray-800 mb-2">–í —á–µ–º –ø—Ä–æ–±–ª–µ–º–∞:</h5>
                            <p class="text-gray-700 mb-4">${selectedMistake.description}</p>
                            <h5 class="font-bold text-green-700 mb-2">–¢–∞–∫—Ç–∏–∫–∞ –∏–∑–±–µ–≥–∞–Ω–∏—è:</h5>
                            <p class="text-gray-700">${selectedMistake.tactic}</p>
                        `;
                    }
                };

                mistakeSelect.addEventListener('change', (e) => {
                    displayMistakeExplanation(e.target.value);
                });
                displayMistakeExplanation(0);
            }

            const quizContainer = document.getElementById('quiz-container');
            const generateQuizBtn = document.getElementById('generate-quiz-btn');
            const mistakesCounter = document.getElementById('mistakes-counter');
            const modal = document.getElementById('feedback-modal');
            const modalExplanation = document.getElementById('modal-explanation');
            const closeModalBtn = document.getElementById('close-modal-btn');
            const quizFinalResults = document.getElementById('quiz-final-results');
            
            let currentQuizData = [];
            let mistakeCount = 0;
            const MAX_MISTAKES = 2;
            
            const shuffleArray = (array) => {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
                return array;
            };

            const initialQuizData = [
                {
                    question: "–ö–ª–∏–µ–Ω—Ç –≤—ã–≥–ª—è–¥–∏—Ç –Ω–∞–ø—Ä—è–∂–µ–Ω–Ω–æ. –° —á–µ–≥–æ –Ω–∞—á–∞—Ç—å –¥–∏–∞–ª–æ–≥?",
                    options: { a: "–°–ø—Ä–æ—Å–∏—Ç—å –ø—Ä–æ –±—é–¥–∂–µ—Ç.", b: "–°–∫–∞–∑–∞—Ç—å: '–ú–æ—è –∑–∞–¥–∞—á–∞ ‚Äî –ø–æ–º–æ—á—å –≤–∞–º —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è, –±–µ–∑ –¥–∞–≤–ª–µ–Ω–∏—è'.", c: "–†–∞—Å—Å–∫–∞–∑–∞—Ç—å –ø—Ä–æ —Å–∞–º—É—é –¥–æ—Ä–æ–≥—É—é –º–∞—à–∏–Ω—É." },
                    answer: "b",
                    technique: "–ó–∞—è–≤–ª–µ–Ω–∏–µ –æ –Ω–∞–º–µ—Ä–µ–Ω–∏—è—Ö"
                },
                {
                    question: "–ö–ª–∏–µ–Ω—Ç: '–Ø –≤–∏–¥–µ–ª —Ç–∞–∫—É—é –∂–µ –º–∞—à–∏–Ω—É –¥–µ—à–µ–≤–ª–µ'. –í–∞—à –æ—Ç–≤–µ—Ç?",
                    options: { a: "–°–∫–∞–∑–∞—Ç—å, —á—Ç–æ —É —á–∞—Å—Ç–Ω–∏–∫–æ–≤ –º–∞—à–∏–Ω—ã —Ö—É–∂–µ.", b: "–°–ø—Ä–æ—Å–∏—Ç—å, –≤—Ö–æ–¥–∏—Ç –ª–∏ –≤ —Ç—É —Ü–µ–Ω—É –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∏ –≥–∞—Ä–∞–Ω—Ç–∏—è.", c: "–ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å —Ç–∞–∫—É—é –∂–µ —Å–∫–∏–¥–∫—É." },
                    answer: "b",
                    technique: "–Ø–∫–æ—Ä–µ–Ω–∏–µ –Ω–∞ —Ü–µ–Ω–Ω–æ—Å—Ç–∏"
                },
                {
                    question: "–ö–ª–∏–µ–Ω—Ç –Ω–∞ —Ç–µ—Å—Ç-–¥—Ä–∞–π–≤–µ –º–æ–ª—á–∏—Ç. –ß—Ç–æ –¥–µ–ª–∞—Ç—å?",
                    options: { a: "–í–∫–ª—é—á–∏—Ç—å –º—É–∑—ã–∫—É –∏ —Ä–∞—Å—Å–∫–∞–∑—ã–≤–∞—Ç—å –ø—Ä–æ –∞—É–¥–∏–æ—Å–∏—Å—Ç–µ–º—É.", b: "–ù–µ –º–µ—à–∞—Ç—å –∏ –¥–∞—Ç—å '–ø–æ—á—É–≤—Å—Ç–≤–æ–≤–∞—Ç—å' –∞–≤—Ç–æ–º–æ–±–∏–ª—å.", c: "–ü–æ—Å—Ç–æ—è–Ω–Ω–æ –∑–∞–¥–∞–≤–∞—Ç—å –≤–æ–ø—Ä–æ—Å—ã: '–ù—É –∫–∞–∫?'" },
                    answer: "b",
                    technique: "–ú–æ–ª—á–∞–ª–∏–≤—ã–π —Ç–µ—Å—Ç-–¥—Ä–∞–π–≤"
                }
            ];
            
            const renderQuiz = (quizData) => {
                if (!quizContainer) return;
                currentQuizData = shuffleArray([...quizData]).slice(0, 3);
                mistakeCount = 0;
                if(mistakesCounter) mistakesCounter.textContent = `–û—à–∏–±–æ–∫: 0 / ${MAX_MISTAKES}`;
                if(quizFinalResults) quizFinalResults.classList.add('hidden');
                quizContainer.innerHTML = "";
                
                currentQuizData.forEach((item, index) => {
                    let optionsHtml = '';
                    const shuffledOptions = shuffleArray(Object.entries(item.options));
                    for(const [key, value] of shuffledOptions) {
                        optionsHtml += `<label class="block p-2 rounded-md border border-gray-200 hover:bg-gray-50 cursor-pointer"><input type="radio" name="q${index}" value="${key}" class="mr-3"> <span>${value}</span></label>`;
                    }
                    quizContainer.innerHTML += `<div class="pt-2" data-question-index="${index}"><h5 class="font-medium text-gray-800 mb-2">${index + 1}. ${item.question}</h5><div class="space-y-2">${optionsHtml}</div></div>`;
                });
            };
            
            if(generateQuizBtn) {
                 generateQuizBtn.addEventListener('click', async () => {
                     if(!quizContainer) return;
                     quizContainer.innerHTML = '<div class="loader mx-auto"></div>';
                     generateQuizBtn.disabled = true;
                     const systemPrompt = `–¢—ã ‚Äî –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–µ—Å—Ç–æ–≤. –°–æ–∑–¥–∞–π 3 —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –°–ò–¢–£–ê–¶–ò–û–ù–ù–´–• –≤–æ–ø—Ä–æ—Å–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–µ—Ö–Ω–∏–∫ –ø—Ä–æ–¥–∞–∂ –±/—É –∞–≤—Ç–æ. –î–ª—è –∫–∞–∂–¥–æ–≥–æ –≤–æ–ø—Ä–æ—Å–∞ –¥–∞–π 3 –≤–∞—Ä–∏–∞–Ω—Ç–∞ –æ—Ç–≤–µ—Ç–∞ (a, b, c). –£–∫–∞–∂–∏ –∫–ª—é—á "technique". –í–µ—Ä–Ω–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –≤–∏–¥–µ –≤–∞–ª–∏–¥–Ω–æ–≥–æ JSON-–º–∞—Å—Å–∏–≤–∞.`;
                     try {
                        const responseText = await callGeminiAPI("–°–æ–∑–¥–∞–π –Ω–æ–≤—ã–π —Ç–µ—Å—Ç.", systemPrompt);
                        const cleanedText = responseText.replace(/^```json\s*|```\s*$/g, '');
                        const newQuizData = JSON.parse(cleanedText);
                        renderQuiz(newQuizData.length >= 3 ? newQuizData : initialQuizData);
                     } catch (error) {
                        console.error("Failed to parse quiz data:", error);
                        renderQuiz(initialQuizData);
                     } finally {
                        generateQuizBtn.disabled = false;
                     }
                });
            }

            if(quizContainer) {
                quizContainer.addEventListener('change', async (event) => {
                    if (event.target.type !== 'radio') return;
                    const selectedLabel = event.target.parentElement;
                    const questionBlock = selectedLabel.closest('[data-question-index]');
                    const questionIndex = parseInt(questionBlock.dataset.questionIndex);
                    const questionData = currentQuizData[questionIndex];
                    const selectedValue = event.target.value;
                    
                    questionBlock.querySelectorAll('input[type="radio"]').forEach(radio => radio.disabled = true);
                    
                    if (selectedValue === questionData.answer) {
                        selectedLabel.classList.add('correct-answer');
                    } else {
                        mistakeCount++;
                        if(mistakesCounter) mistakesCounter.textContent = `–û—à–∏–±–æ–∫: ${mistakeCount} / ${MAX_MISTAKES}`;
                        selectedLabel.classList.add('incorrect-answer');
                        const correctRadio = questionBlock.querySelector(`input[value="${questionData.answer}"]`);
                        if(correctRadio) correctRadio.parentElement.classList.add('correct-answer');
                        if(modal) modal.classList.add('show');
                        if(modalExplanation) modalExplanation.innerHTML = '<div class="loader mx-auto"></div>';
                        const systemPrompt = "–¢—ã ‚Äî –∫–æ—É—á –ø–æ –ø—Ä–æ–¥–∞–∂–∞–º. –û–±—ä—è—Å–Ω–∏, –ø–æ—á–µ–º—É –æ—Ç–≤–µ—Ç –≤–µ—Ä–Ω—ã–π, —Å—Å—ã–ª–∞—è—Å—å –Ω–∞ —Ç–µ—Ö–Ω–∏–∫—É –ø—Ä–æ–¥–∞–∂.";
                        const userPrompt = `–°–∏—Ç—É–∞—Ü–∏—è: "${questionData.question}".\n–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç: "${questionData.options[questionData.answer]}".\n–¢–µ—Ö–Ω–∏–∫–∞: "${questionData.technique}".\n\n–û–±—ä—è—Å–Ω–∏.`;
                        const explanationText = await callGeminiAPI(userPrompt, systemPrompt);
                        if(modalExplanation) modalExplanation.innerHTML = explanationText.replace(/\n/g, "<br>");
                    }

                    const answeredCount = quizContainer.querySelectorAll('input:disabled').length / 3;
                    if (answeredCount === currentQuizData.length) {
                         const score = currentQuizData.length - mistakeCount;
                         const percentage = Math.round((score / currentQuizData.length) * 100);
                         let resultMessage = '–°—Ç–æ–∏—Ç –µ—â–µ —Ä–∞–∑ –∏–∑—É—á–∏—Ç—å —Ç–µ–æ—Ä–∏—é. üß†';
                         if (percentage >= 80) resultMessage = '–û—Ç–ª–∏—á–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç! üëç';
                         else if (percentage >= 50) resultMessage = '–•–æ—Ä–æ—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç, –Ω–æ –µ—Å—Ç—å —á—Ç–æ —É–ª—É—á—à–∏—Ç—å. üöÄ';
                         if(quizFinalResults) {
                            quizFinalResults.innerHTML = `<h4 class="text-xl mb-2">–¢–µ—Å—Ç –∑–∞–≤–µ—Ä—à–µ–Ω!</h4><p class="text-2xl text-blue-600">${score} –∏–∑ ${currentQuizData.length} (${percentage}%)</p><p class="mt-2 text-gray-600 font-medium">${resultMessage}</p>`;
                            quizFinalResults.classList.remove('hidden');
                        }
                    }
                });
            }

            const closeModalAndCheckRestart = () => {
                if (modal) modal.classList.remove('show');
                if (mistakeCount > MAX_MISTAKES) {
                    setTimeout(() => renderQuiz(initialQuizData), 300);
                }
            };

            if (closeModalBtn) closeModalBtn.addEventListener('click', closeModalAndCheckRestart);
            if (modal) modal.addEventListener('click', (e) => {
                if (e.target === modal) closeModalAndCheckRestart();
            });

            renderQuiz(initialQuizData);

            const backToTopBtn = document.getElementById("back-to-top");
            if(backToTopBtn) {
                window.addEventListener("scroll", () => {
                    if (window.scrollY > 300) backToTopBtn.classList.add("show");
                    else backToTopBtn.classList.remove("show");
                });
                backToTopBtn.addEventListener("click", () => window.scrollTo({ top: 0, behavior: "smooth" }));
            }
        });
    </script>
</body>
</html>

